# ç®­å¤´å‡½æ•°

## ä»€ä¹ˆæ˜¯ç®­å¤´å‡½æ•°

ç®­å¤´å‡½æ•°æ˜¯ `ES6` æ–°å¢çš„ä¸€ç§å®šä¹‰å‡½æ•°è¡¨è¾¾å¼çš„è¯­æ³•ï¼Œå®ƒç®€åŒ–äº†æˆ‘ä»¬ä¹‹å‰å†™çš„å‡½æ•°ä¹¦å†™æ–¹å¼ï¼Œç®­å¤´å‡½æ•°å®ä¾‹åŒ–çš„å‡½æ•°å¯¹è±¡ä¸æˆ‘ä»¬ `ES5` ä¹‹å‰åˆ›å»ºçš„å‡½æ•°è¡¨è¾¾å¼çš„åˆ›å»ºå‡½æ•°è¡Œä¸ºæ˜¯ç›¸åŒçš„ã€‚åœ¨ä»»ä½•ä½¿ç”¨å‡½æ•°è¡¨è¾¾å¼çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç®­å¤´å‡½æ•°ã€‚

---

**ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°æœ‰å“ªäº›åŒºåˆ«**

## ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘è§„åˆ™

### - ç®­å¤´å‡½æ•°æ²¡æœ‰ `prototype(åŸå‹)`ï¼Œæ‰€ä»¥ç®­å¤´å‡½æ•°æœ¬èº«æ²¡æœ‰ `this`

```js
let sg = () => {}
console.log(sg.prototype) // undefined
```

### - ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘åœ¨å®šä¹‰çš„æ—¶å€™ç»§æ‰¿è‡ªå¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„ `this`

ä¸€ä¸ªå‡½æ•°ä¸­å®šä¹‰ç®­å¤´å‡½æ•°ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªå‡½æ•°ä¸­æ‰§è¡Œç®­å¤´å‡½æ•°ã€‚

```js
let a,
  barObj = { msg: 'barçš„thisæŒ‡å‘' }

fooObj = { msg: 'fooçš„thisæŒ‡å‘' }

bar.call(barObj) // å°†barçš„thisæŒ‡å‘barObj
foo.call(fooObj) // å°†fooçš„thisæŒ‡å‘fooObj

function foo() {
  a() // ç»“æœï¼š{ msg: 'barçš„thisæŒ‡å‘' }
}

function bar() {
  a = () => {
    console.log(this, 'thisæŒ‡å‘å®šä¹‰çš„æ—¶å€™å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°') //
  } // åœ¨barä¸­å®šä¹‰ thisç»§æ‰¿äºbarå‡½æ•°çš„thisæŒ‡å‘
}
```

ä»ä¸Šé¢ ğŸŒ° ä¸­å¯ä»¥å¾—å‡ºä¸¤ç‚¹ï¼š

- ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘å®šä¹‰æ—¶æ‰€åœ¨çš„å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œè·Ÿä½¿ç”¨ä½ç½®æ²¡æœ‰å…³ç³»ã€‚
- è¢«ç»§æ‰¿çš„æ™®é€šå‡½æ•°çš„ `this` æŒ‡å‘æ”¹å˜ï¼Œç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘ä¼šè·Ÿç€æ”¹å˜

#### - ä¸èƒ½ç›´æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘

ä¸Šä¸ª ğŸŒ° ä¸­çš„ foo å‡½æ•°ä¿®æ”¹ä¸€ä¸‹ï¼Œå°è¯•ç›´æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘ã€‚

```js
let fnObj = { msg: 'å°è¯•ç›´æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„thisæŒ‡å‘' }

function foo() {
  a.call(fnObj) // ç»“æœï¼š{ msg: 'barçš„thisæŒ‡å‘' }
}
```

å¾ˆæ˜æ˜¾ï¼Œ`call` æ˜¾ç¤ºç»‘å®š `this` æŒ‡å‘å¤±è´¥äº†ï¼ŒåŒ…æ‹¬ `apply`ã€`bind` éƒ½ä¸€æ ·ã€‚

> å®ƒä»¬(`call`ã€`apply`ã€`bind`)ä¼šé»˜è®¤å¿½ç•¥ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä½†æ˜¯å¯ä»¥æ­£å¸¸ä¼ å‚ã€‚

ç„¶åæˆ‘åˆé€šè¿‡éšå¼ç»‘å®šæ¥å°è¯•åŒæ ·ä¹Ÿå¤±è´¥äº†ï¼Œ`new` è°ƒç”¨ä¼šæŠ¥é”™ï¼Œæ‰€æœ‰ï¼Œç®­å¤´å‡½æ•°ä¸èƒ½ç›´æ¥ä¿®æ”¹å®ƒçš„ `this` æŒ‡å‘ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é—´æ¥çš„å½¢å¼æ¥ä¿®æ”¹ç®­å¤´å‡½æ•°çš„æŒ‡å‘ï¼š

å»ä¿®æ”¹è¢«ç»§æ‰¿çš„æ™®é€šå‡½æ•°çš„ `this` æŒ‡å‘ï¼Œç„¶åç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘ä¹Ÿä¼šè·Ÿç€æ”¹å˜ï¼Œè¿™åœ¨ä¸Šä¸€ä¸ª ğŸŒ° ä¸­æœ‰æ¼”ç¤ºã€‚

```js
// å°†baræ™®é€šå‡½æ•°çš„thisæŒ‡å‘barObj ç„¶åå†…éƒ¨çš„ç®­å¤´å‡½æ•°ä¹Ÿä¼šæŒ‡å‘barObj
bar.call(barObj)
```

### - ç®­å¤´å‡½æ•°å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°ï¼Œä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„ `this` éƒ½ä¼šæŒ‡å‘ `window`(å…¨å±€å¯¹è±¡)

æ—¢ç„¶ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘åœ¨å®šä¹‰çš„æ—¶å€™ç»§æ‰¿è‡ªå¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„ `this`ï¼Œé‚£ä¹ˆå½“ç®­å¤´å‡½æ•°å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°ï¼Œå®ƒçš„ `this` ä¼šæŒ‡å‘å“ªé‡Œï¼Ÿ

è¿™é‡Œè·Ÿæˆ‘ä¹‹å‰å†™çš„ `this` ç»‘å®šè§„åˆ™ä¸å¤ªä¸€æ ·(ä¸æ‡‚çš„å¯ä»¥ç‚¹è¿›å»çœ‹ä¸€ä¸‹),æ™®é€šå‡½æ•°çš„é»˜è®¤ç»‘å®šè§„åˆ™æ˜¯ï¼š

- åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œé»˜è®¤ç»‘å®šçš„ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ `this` æŒ‡å‘ `undefined`
- å¦‚æœç®­å¤´å‡½æ•°å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°ç»§æ‰¿ï¼Œå®ƒ `this` æŒ‡å‘çš„è§„åˆ™ï¼šç®­å¤´å‡½æ•°åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹ï¼Œä¸¥æ ¼æ¨¡å¼å’Œéä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„ `this` éƒ½ä¼šæŒ‡å‘ `window`(å…¨å±€å¯¹è±¡)ã€‚

ä¸¥æ ¼æ¨¡å¼åœ¨ä¸­é€”å£°æ˜æ— æ•ˆï¼Œå¿…é¡»åœ¨å…¨å±€/å‡½æ•°çš„å¼€å¤´å£°æ˜æ‰ä¼šç”Ÿæ•ˆï¼š

```js
a = 1
;('use strict') // ä¸¥æ ¼æ¨¡å¼æ— æ•ˆ å¿…é¡»åœ¨ä¸€å¼€å§‹å°±å£°æ˜ä¸¥æ ¼æ¨¡å¼

b = 2 // ä¸æŠ¥é”™
```

## ç®­å¤´å‡½æ•°çš„ `arguments`

### - ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘å…¨å±€ï¼Œä½¿ç”¨ `arguments` ä¼šæŠ¥æœªå£°æ˜çš„é”™è¯¯

å¦‚æœç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘ `window`(å…¨å±€å¯¹è±¡)ä½¿ç”¨ `arguments` ä¼šæŠ¥é”™ï¼Œæœªå£°æ˜ `arguments`ã€‚

```js
let b = () => {
  console.log(arguments)
}

b(1, 2, 3, 4)

Uncaught ReferenceError: arguments is not defined
```

å¦‚æœä½ å£°æ˜äº†ä¸€ä¸ªå…¨å±€å˜é‡ä¸º `arguments`ï¼Œé‚£å°±ä¸ä¼šæŠ¥é”™äº†ï¼Œä½†æ˜¯ä½ ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ

ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘æ™®é€šå‡½æ•°æ—¶,å®ƒçš„ arguments` ç»§æ‰¿äºè¯¥æ™®é€šå‡½æ•°

ä¸Šé¢æ˜¯ç¬¬ä¸€ç§æƒ…å†µï¼šç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œä¼šæŠ¥ `arguments` æœªå£°æ˜çš„é”™è¯¯ã€‚

ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼šç®­å¤´å‡½æ•°çš„ `this` å¦‚æœæŒ‡å‘æ™®é€šå‡½æ•°,å®ƒçš„ `arguments` ç»§æ‰¿äºè¯¥æ™®é€šå‡½æ•°ã€‚

```js
function bar() {
  console.log(arguments) // ['å¤–å±‚ç¬¬äºŒä¸ªæ™®é€šå‡½æ•°çš„å‚æ•°']
  bb('å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„å‚æ•°')
  function bb() {
    console.log(arguments) // ["å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„å‚æ•°"]
    let a = () => {
      console.log(arguments, 'argumentsç»§æ‰¿thisæŒ‡å‘çš„é‚£ä¸ªæ™®é€šå‡½æ•°') // ["å¤–å±‚ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„å‚æ•°"]
    }
    a('ç®­å¤´å‡½æ•°çš„å‚æ•°') // thisæŒ‡å‘bb
  }
}
bar('å¤–å±‚ç¬¬äºŒä¸ªæ™®é€šå‡½æ•°çš„å‚æ•°')
```

é‚£ä¹ˆåº”è¯¥å¦‚ä½•æ¥è·å–ç®­å¤´å‡½æ•°ä¸å®šæ•°é‡çš„å‚æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼š`ES6` çš„ `rest` å‚æ•°ï¼ˆ...æ‰©å±•ç¬¦ï¼‰

### - ä½¿ç”¨ `new` è°ƒç”¨ç®­å¤´å‡½æ•°ä¼šæŠ¥é”™

æ— è®ºç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘å“ªé‡Œï¼Œä½¿ç”¨ `new` è°ƒç”¨ç®­å¤´å‡½æ•°éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºç®­å¤´å‡½æ•°æ²¡æœ‰ `constructor`ã€‚

```js
let a = () => {}
let b = new a() // a is not a constructor
```

### - ç®­å¤´å‡½æ•°ä¸æ”¯æŒ `new.target`

`new.target` æ˜¯ `ES6` æ–°å¼•å…¥çš„å±æ€§ï¼Œæ™®é€šå‡½æ•°å¦‚æœé€šè¿‡ new è°ƒç”¨ï¼Œ`new.target` ä¼šè¿”å›è¯¥å‡½æ•°çš„å¼•ç”¨ã€‚

æ­¤å±æ€§ä¸»è¦ï¼šç”¨äºç¡®å®šæ„é€ å‡½æ•°æ˜¯å¦ä¸º `new` è°ƒç”¨çš„ã€‚

- ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œåœ¨ç®­å¤´å‡½æ•°ä¸­ä½¿ç”¨ç®­å¤´å‡½æ•°ä¼šæŠ¥é”™

```js
let a = () => {
  console.log(new.target); // æŠ¥é”™ï¼šnew.target ä¸å…è®¸åœ¨è¿™é‡Œä½¿ç”¨
};
a();
```

- ç®­å¤´å‡½æ•°çš„ `this` æŒ‡å‘æ™®é€šå‡½æ•°ï¼Œå®ƒçš„ `new.target` å°±æ˜¯æŒ‡å‘è¯¥æ™®é€šå‡½æ•°çš„å¼•ç”¨

```js
new bb()
function bb() {
  let a = () => {
    console.log(new.target) // æŒ‡å‘å‡½æ•°bbï¼šfunction bb(){...}
  }
  a()
}
```

## ç®­å¤´å‡½æ•°ä¸æ”¯æŒé‡å‘½åå‡½æ•°å‚æ•°,æ™®é€šå‡½æ•°çš„å‡½æ•°å‚æ•°æ”¯æŒé‡å‘½å

å¦‚ä¸‹ ğŸŒ°ï¼Œæ™®é€šå‡½æ•°çš„å‡½æ•°å‚æ•°æ”¯æŒé‡å‘½åï¼Œåé¢å‡ºç°çš„ä¼šè¦†ç›–å‰é¢çš„ï¼Œç®­å¤´å‡½æ•°ä¼šæŠ›å‡ºé”™è¯¯ï¼š

```js
function func1(a, a) {
  console.log(a, arguments) // 2 [1,2]
}

var func2 = (a, a) => {
  console.log(a) // æŠ¥é”™ï¼šåœ¨æ­¤ä¸Šä¸‹æ–‡ä¸­ä¸å…è®¸é‡å¤å‚æ•°åç§°
}
func1(1, 2)
func2(1, 2)
```

## ç®­å¤´å‡½æ•°ç›¸å¯¹äºæ™®é€šå‡½æ•°è¯­æ³•æ›´ç®€æ´ä¼˜é›…

- ç®­å¤´å‡½æ•°éƒ½æ˜¯åŒ¿åå‡½æ•°ï¼Œå¹¶ä¸”éƒ½ä¸ç”¨å†™ `function`

- åªæœ‰ä¸€ä¸ªå‚æ•°çš„æ—¶å€™å¯ä»¥çœç•¥æ‹¬å·:

```js
var f = (a) => a // ä¼ å…¥a è¿”å›a
```

- å‡½æ•°åªæœ‰ä¸€æ¡è¯­å¥æ—¶å¯ä»¥çœç•¥{}å’Œ `return`

```js
var f = (a, b, c) => a // ä¼ å…¥a,b,c è¿”å›a
```

- ç®€åŒ–å›è°ƒå‡½æ•°ï¼Œè®©ä½ çš„å›è°ƒå‡½æ•°æ›´ä¼˜é›…

```js
;[1, 2, 3].map(function (x) {
  return x * x
}) // æ™®é€šå‡½æ•°å†™æ³•
```

```js
;[(1, 2, 3)].map((x) => x * x) // ç®­å¤´å‡½æ•°åªéœ€è¦ä¸€è¡Œ
```

## ç®­å¤´å‡½æ•°çš„æ³¨æ„äº‹é¡¹

- ä¸€æ¡è¯­å¥è¿”å›å¯¹è±¡å­—é¢é‡ï¼Œéœ€è¦åŠ æ‹¬å·ï¼Œæˆ–è€…ç›´æ¥å†™æˆå¤šæ¡è¯­å¥çš„ `return` å½¢å¼

```js
var func1 = () => {
  foo: 1
} // æƒ³è¿”å›ä¸€ä¸ªå¯¹è±¡,èŠ±æ‹¬å·è¢«å½“æˆå¤šæ¡è¯­å¥æ¥è§£æï¼Œæ‰§è¡Œåè¿”å›undefined

var func2 = () => ({ foo: 1 }) // ç”¨åœ†æ‹¬å·æ˜¯æ­£ç¡®çš„å†™æ³•

var func2 = () => {
  return {
    foo: 1, // æ›´æ¨èç›´æ¥å½“æˆå¤šæ¡è¯­å¥çš„å½¢å¼æ¥å†™ï¼Œå¯è¯»æ€§é«˜
  }
}
```

- ç®­å¤´å‡½æ•°åœ¨å‚æ•°å’Œç®­å¤´ä¹‹é—´ä¸èƒ½æ¢è¡Œï¼

```js
var func = ()
           => 1;  // æŠ¥é”™ï¼š Unexpected token =>

```

- ç®­å¤´å‡½æ•°çš„è§£æé¡ºåºç›¸å¯¹é å‰

`MDN`: è™½ç„¶ç®­å¤´å‡½æ•°ä¸­çš„ç®­å¤´ä¸æ˜¯è¿ç®—ç¬¦ï¼Œä½†ç®­å¤´å‡½æ•°å…·æœ‰ä¸å¸¸è§„å‡½æ•°ä¸åŒçš„ç‰¹æ®Š[è¿ç®—ç¬¦ä¼˜å…ˆçº§](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence)è§£æè§„åˆ™

## ç®­å¤´å‡½æ•°ä¸é€‚ç”¨åœºæ™¯

### å®šä¹‰å­—é¢é‡æ–¹æ³•,`this` çš„æ„å¤–æŒ‡å‘

```js
const obj = {
  array: [1, 2, 3],
  sum: () => {
    // æ ¹æ®ä¸Šæ–‡å­¦åˆ°çš„ï¼šå¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°thisä¼šæŒ‡å‘å…¨å±€å¯¹è±¡
    return this.array.push('å…¨å±€å¯¹è±¡ä¸‹æ²¡æœ‰arrayï¼Œè¿™é‡Œä¼šæŠ¥é”™') // æ‰¾ä¸åˆ°pushæ–¹æ³•
  },
}
obj.sum()
```

ä¸Šè¿°æ —å­ä½¿ç”¨æ™®é€šå‡½æ•°æˆ–è€… `ES6` ä¸­çš„æ–¹æ³•ç®€å†™çš„æ¥å®šä¹‰æ–¹æ³•ï¼Œå°±æ²¡æœ‰é—®é¢˜äº†

```js
// è¿™ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„
sum() {
  return this.array.push('thisæŒ‡å‘obj');
}

sum: function() {
  return this.array.push('thisæŒ‡å‘obj');
}
```

è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç»™æ™®é€šå‡½æ•°çš„åŸå‹å®šä¹‰æ–¹æ³•çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šåœ¨æ™®é€šå‡½æ•°çš„å¤–éƒ¨è¿›è¡Œå®šä¹‰ï¼Œæ¯”å¦‚è¯´ç»§æ‰¿/æ·»åŠ æ–¹æ³•çš„æ—¶å€™ã€‚

è¿™æ—¶å€™å› ä¸ºæ²¡æœ‰åœ¨æ™®é€šå‡½æ•°çš„å†…éƒ¨è¿›è¡Œå®šä¹‰ï¼Œæ‰€ä»¥ `this` ä¼šæŒ‡å‘å…¶ä»–æ™®é€šå‡½æ•°ï¼Œæˆ–è€…å…¨å±€å¯¹è±¡ä¸Šï¼Œå¯¼è‡´ `bugï¼`

### å›è°ƒå‡½æ•°çš„åŠ¨æ€ `this`

ä¸‹é¢çš„æ —å­æ˜¯ä¸€ä¸ªä¿®æ”¹ dom æ–‡æœ¬çš„æ“ä½œï¼Œå› ä¸º `this` æŒ‡å‘é”™è¯¯ï¼Œå¯¼è‡´ä¿®æ”¹å¤±è´¥

```js
const button = document.getElementById('myButton')
button.addEventListener('click', () => {
  this.innerHTML = 'Clicked button' // thisåˆæŒ‡å‘äº†å…¨å±€
})
```
