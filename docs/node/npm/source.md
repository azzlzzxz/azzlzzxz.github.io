# NPM

[npm å®˜ç½‘](https://www.npmjs.com/)

## ä»‹ç» `NPM`

`npmï¼ˆNode Package Managerï¼‰`æ˜¯ä¸€ç§ç”¨äºç®¡ç† `JavaScript` è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹çš„åŒ…ç®¡ç†å·¥å…·ã€‚å®ƒæ˜¯ `Node.js` ç”Ÿæ€ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ˜¯æœ€å¸¸ç”¨çš„ `JavaScript` åŒ…ç®¡ç†å™¨ä¹‹ä¸€ã€‚ä»¥ä¸‹æ˜¯ `npm` çš„ä¸€äº›å…³é”®ç‰¹ç‚¹å’ŒåŠŸèƒ½ï¼š

1. åŒ…ç®¡ç†ã€å‘å¸ƒã€å®‰è£…
2. ä¾èµ–é¡¹ç®¡ç†
3. ç‰ˆæœ¬ç®¡ç†
4. è„šæœ¬è¿è¡Œ

```json
package.json
{
  "private": true, // æ˜¯å¦ç§æœ‰
  "name": "xxx", // åŒ…å/é¡¹ç›®å
  "bin": {// æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æˆ–å‘½ä»¤
    "cli": "./bin/cli.js"
  },
  "description": "this is test project", // æè¿°
  "version": "1.0.0", // ç‰ˆæœ¬
  "scripts": {
    // è„šæœ¬
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "repository": {
    // ä»“åº“åœ°å€
    "type": "git",
    "url": "https://github.com/xxx/xxx.git"
  },
  "keywords": ["test", "project", "azzlzzxz"], // æœç´¢å…³é”®å­—
  "author": "xxx", // ä½œè€…npmç”¨æˆ·
  "license": "ISC", // å¼€æºåè®®
  "bugs": {
    // é¡¹ç›®é—®é¢˜è·Ÿè¸ªå™¨çš„ url å’Œ/æˆ–åº”æŠ¥å‘Šé—®é¢˜çš„ç”µå­é‚®ä»¶åœ°å€
    "url": "https://github.com/owner/project/issues",
    "email": "project@hostname.com"
  },
  "homepage": "https://github.com/xxx/xxx", // ä¸»é¡µ
  "dependencies": {
    // ç”Ÿäº§ä¾èµ–
    "my_dep": "^1.0.0",
    "another_dep": "~2.2.0"
  },
  "devDependencies": {
    // å¼€å‘ä¾èµ–
    "my_test_framework": "^3.1.0",
    "another_dev_dep": "1.0.0 - 1.2.0"
  }
}
```

- `dependenciesï¼š` ç”Ÿäº§ç¯å¢ƒéœ€è¦çš„ä¾èµ–`ï¼ˆ-P/--save-prodï¼‰`ã€‚
- `devDependenciesï¼š`å·¥ç¨‹åªæœ‰å¼€å‘ç¯å¢ƒéœ€è¦ï¼Œç”Ÿäº§ç¯å¢ƒä¸éœ€è¦çš„ä¾èµ–`ï¼ˆ-D/--save-devï¼‰`ã€‚
- `optionalDependenciesï¼š`ä¾èµ–æ˜¯å¯é€‰çš„ï¼Œå®ƒä»¬åªæœ‰åœ¨è¿è¡Œæ—¶éœ€è¦ä½¿ç”¨æŸäº›åŠŸèƒ½æ—¶æ‰ä¼šè¢«å¼•å…¥`ï¼ˆ-O/--save-optionalï¼‰`ã€‚
- `peerDependenciesï¼š`å·¥ç¨‹éœ€è¦å’Œè¿™ä¸ªä¾èµ–é…å¥—ä½¿ç”¨ï¼Œä¸€èˆ¬ç”¨äºè§£å†³æ’ä»¶ä¾èµ–çš„æ ¸å¿ƒåº“çš„ç‰ˆæœ¬å’Œä¸»é¡¹ç›®ä¾èµ–çš„æ ¸å¿ƒåº“çš„ç‰ˆæœ¬ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå¸¸è§äºå¼€å‘é…å¥—æ’ä»¶ã€‚
- b`undledDependenciesï¼š`å·¥ç¨‹ä¾èµ–äºæŸäº›ç‰¹å®šçš„ä¾èµ–é¡¹ï¼Œå¹¶ä¸”å¸Œæœ›åœ¨è¿è¡Œæ—¶ä¸å¿…å†æ¬¡ä¸‹è½½å®ƒä»¬ï¼Œåˆ™å¯ä»¥ä½¿ç”¨è¯¥é€‰é¡¹ï¼ˆ`-B/--save-bundleï¼‰`ã€‚

## å‘å¸ƒä¸€ä¸ª `npm` åŒ…(å…¬å…±)

1. é¦–å…ˆéœ€è¦åˆ° [<u>npm å®˜ç½‘</u>](https://www.npmjs.com/) æ³¨å†Œä¸€ä¸ª `npm` è´¦å·

> ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æœ¬åœ°æ‰§è¡Œ `npm adduser` æ¥åˆ›å»ºè´¦æˆ·

2. åœ¨æœ¬åœ°é€šè¿‡è¿è¡Œ `npm login` ç™»é™†ä½ çš„ `npm` è´¦å·

> `npm whoami` å¯ä»¥æŸ¥çœ‹åˆ°å½“å‰ç™»é™†çš„ç”¨æˆ·å

3. åˆå§‹åŒ–é¡¹ç›®

- `npm init -y` å¯ä»¥åœ¨å½“å‰ç›®å½•ä¸‹å¿«é€Ÿåˆå§‹åŒ–ä¸€ä¸ª `package.json` æ–‡ä»¶

```json
{
  "name": "azzlzzxz",
  "description": "this is test project",
  "version": "1.0.0",
  "repository": {
    "type": "git",
    "url": "https://github.com/xxx/xxx.git"
  },
  "keywords": ["test", "project", "azzlzzxz"],
  "author": "xxx",
  "license": "ISC",
  "bugs": {
    "url": "https://github.com/owner/project/issues",
    "email": "project@hostname.com"
  },
  "homepage": "https://github.com/xxx/xxx",
  "main": "index.js"
}
```

- ç¼–å†™ä»£ç /ä¿®æ”¹ä»£ç 

  - å¦‚æœä½ æ˜¯ä¿®æ”¹ä»£ç ï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦ä¿®æ”¹ `package.json` ä¸­çš„ `version` æ¥ä¿®æ”¹ç‰ˆæœ¬ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¿è¡Œ `npm version xxx`æ¥æ™ºèƒ½çš„ç”Ÿæˆæ–°ç‰ˆæœ¬å·ï¼ˆå‘½ä»¤å‚æ•°è¯¦è§å®˜ç½‘æˆ–è€… `npm version -h` ï¼‰

  - å‡çº§ç‰ˆæœ¬ï¼š
    `npm version patch` : `package.json` ä¸­çš„ç‰ˆæœ¬å· `2.0.0` å˜ä¸º `2.0.1`
    `npm version minor`: `package.json` ä¸­çš„ç‰ˆæœ¬å· `2.0.1` å˜ä¸º `2.1.0`
    `npm version major` : `package.json` ä¸­çš„ç‰ˆæœ¬å· `2.1.0` å˜ä¸º `3.0.0`

- ä½¿ç”¨ `npm publish` å‘å¸ƒå½“å‰åŒ…åˆ° `npm` ä»“åº“

## å‘å¸ƒå±äºæŸä¸ª `scope` æˆ–è€…ç»„ç»‡ä¸‹çš„åŒ…

åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯¹äºä¸€äº›ä¸èƒ½å®Œå…¨å’Œé¡¹ç›®æˆ–è€…æ¡†æ¶è§£è—•çš„ `npm` åŒ…æˆ‘ä»¬ä¸€èˆ¬ä¼šå°†å…¶å‘å¸ƒåˆ°ç›¸åº”çš„å‘½åç©ºé—´æˆ–è€…ç»„ç»‡ä¸‹ï¼Œä¾‹å¦‚`@vue/cli`ã€ `@vue/runtime-core`ã€ `@vue/composition-api`...ä»–ä»¬éƒ½æ˜¯ `vue` ç»„ç»‡ä¸‹çš„åŒ…ï¼ŒåŒç† `@bable/xxx`ã€`@webpack/xxx` ç­‰ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚

å½“æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ªå…¬å¸å†…éƒ¨çš„é¡¹ç›®æ—¶ä¸€èˆ¬ä¹Ÿä¼šæ­å»º `npm` ç§æœï¼Œç„¶ååœ¨å…¶ä¸­åˆ›å»ºé¡¹ç›®çš„ `scope`ï¼Œç„¶åå°†é¡¹ç›®çš„ `npm` å‘å¸ƒä¸Šå»ã€‚

1. éœ€è¦ `name` ç”¨ @ç»„ç»‡å å¼€å¤´ï¼Œä¾‹å¦‚ `@vue/cli`

```json
{
  "name": "@azzlzzxz/form",
  "version": "1.0.4",
  "description": "",
  "main": "index.js",
  "keywords": ["test", "project"],
  "author": "azzlzzxz",
  "license": "ISC",
  "dependencies": {
    "jquery": "^3.6.0",
    "lodash": "<4.2.0"
  }
}
```

2. ä½ çš„ `npm` è´¦æˆ·éœ€è¦å±äºè¿™ä¸ªç»„ç»‡æˆ–è€…å‘½åç©ºé—´

```shell
npm set registry http://nexus.xxx
è¾“å…¥ï¼šnpm config get registry æ£€æŸ¥æºæ˜¯å¦åˆ‡æ¢æˆåŠŸ

åœ¨æœ¬åœ°æ³¨å†Œå¹¶ç™»å½•ç”¨æˆ·
npm adduser --registry http://nexus.xxx
```

3. å¦‚æœå‘å¸ƒçš„åŒ…å±äºæŸä¸€ä¸ª `scope` æˆ–è€…ç»„ç»‡ï¼Œå¦‚æœæ˜¯é `npm` å®˜æ–¹é•œåƒï¼ˆä¸€èˆ¬å°±æ˜¯æŒ‡ç§æœ‰ `npm` ä»“åº“ï¼‰ï¼Œé‚£ä¹ˆä½ è¿˜éœ€è¦é…ç½® `publishConfig.registry` æ¥æŒ‡å®šé•œåƒåœ°å€ã€‚

```json
// package.json
{
  // ...
  "publishConfig": {
    "registry": "ç§æœ‰é•œåƒåœ°å€"
  }
  // ...
}
```

4. å‘å¸ƒ `npm` åŒ…

```shell
npm publish --registry 'xxxï¼šç§æœé•œåƒæº'
```

## è°ƒè¯•/ä¿®æ”¹åŒ…

æˆ‘ä»¬åœ¨å¼€å‘ä¸€ä¸ª `@azzlzzxz/form` åŒ…æ—¶ï¼Œç»å¸¸ä¼šåœ¨æœ¬åœ°å…ˆåšä¸€äº›æµ‹è¯•æˆ–è€…ä¿®æ”¹ã€‚å¦‚æœæˆ‘ä»¬æœ¬åœ°æ­£å¥½æœ‰ä¸€ä¸ªé¡¹ç›® `project1` åœ¨ä½¿ç”¨è¿™ä¸ªåŒ…æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé¡¹ç›®æ¥æ£€éªŒåŒ…çš„è¿è¡Œç»“æœå½“ç„¶æ˜¯ä¸äºŒä¹‹é€‰ï¼Œæ‰€ä»¥æˆ‘å°±éœ€è¦å°†æˆ‘ä»¬ä¿®æ”¹çš„åŒ…ç»™æ”¾å…¥é¡¹ç›®çš„ `node_modules` ä¸­æ¥æ›¿æ¢çº¿ä¸Šçš„ç‰ˆæœ¬ã€‚è¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨åˆ° `npm link` å‘½ä»¤äº†ã€‚

1. åœ¨ä½ çš„ `@azzlzzxz/form` ç›®å½•ä¸‹è¿è¡Œ `npm link` å‘½ä»¤ï¼Œä¸åŠ ä»»ä½•å‚æ•°ã€‚è¿™ä¸€æ­¥ä¼šåœ¨ä½ å…¨å±€çš„ `node_modules` ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º `@azzlzzxz/form` çš„é“¾æ¥ï¼ˆå¯ä»¥ç†è§£ä¸ºå¿«æ·æ–¹å¼ï¼‰é“¾æ¥åˆ°ä½ çš„ `@azzlzzxz/form` ä»£ç æ‰€åœ¨ç›®å½•ã€‚

2. åœ¨ `project1` ç›®å½•ä¸‹è¿è¡Œ `npm link` `@azzlzzxz/form` ï¼Œè¿™ä¸€æ­¥å°±æ˜¯åœ¨ `project1` çš„ `node_modules` ä¸­å†åˆ›å»ºä¸€ä¸ª `@azzlzzxz/form` é“¾æ¥é“¾æ¥åˆ°å…¨å±€çš„ `node_modules/@azzlzzxz/form`ã€‚

è¿™æ ·å½“ä½ ä¿®æ”¹ `@azzlzzxz/form` çš„ä»£ç æ—¶ï¼Œ `project1` ä¸­çš„ `@azzlzzxz/form` ä»£ç ä¹Ÿä¼šåŒæ­¥ã€‚

## å®‰è£…æœ¬åœ°åŒ…

ä¸Šé¢è¯´åˆ° `npm link` å¯ä»¥åˆ›å»ºé“¾æ¥ç›´æ¥é“¾æ¥åˆ°æœ¬åœ°å¯¹åº”åŒ…çš„ä»£ç ç›®å½•ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¿è¡Œ `npm i`æˆ–è€… `node_modules` ä¸¢å¤±ä¹‹ç±»çš„æƒ…å†µæ—¶ï¼Œå†æ¬¡å®‰è£…å°±ä¼šå‡ºç°å» `npm` å®˜ç½‘ä¸‹è½½åŒ…ä»£ç è€Œä¸æ˜¯åˆ›å»ºé“¾æ¥ï¼ŒåŸå› æ˜¯ `npm link` å¹¶ä¸ä¼šåœ¨ `package.json` å­˜åœ¨è®°å½•ã€‚ä½†æ˜¯æœ‰çš„æ—¶å€™æˆ‘ä»¬æƒ³å¼€å‘ä¸€ä¸ªç§æœ‰åŒ…ï¼Œä¸æƒ³å‘å¸ƒåˆ° `npm` ä¸Šï¼Œåˆè¦è¿è¡Œ `npm install` èƒ½æ­£å¸¸å®‰è£…è¿™ä¸ªåŒ…ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ã€‚

```shell
npm install å¾…å®‰è£…åŒ…çš„ç›¸å¯¹è·¯å¾„
```

å½“è¿è¡Œ `npm i ../bar`æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `package.json` ä¸­çœ‹åˆ°ç›¸å…³ä¿¡æ¯

```json
{
  "name": "@azzlzzxz/form",
  "version": "1.0.4",
  "description": "",
  "main": "index.js",
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@yuexi111/bar": "file:../bar", // <---- è¿™é‡Œ
    "jquery": "^3.6.0",
    "lodash": "<4.2.0"
  }
}
```

## `npm` å¸¸ç”¨çš„å‘½ä»¤å¦‚ä½•å·¥ä½œçš„

### `npm run`

`npm run` æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤ï¼Œä»–çš„ä½œç”¨æ˜¯è¿è¡Œ `pacgake.json` ä¸­æŒ‡å®šçš„è„šæœ¬

```json
// package.josn
{
  "name": "demo",
  "version": "1.0.7",
  "scripts": {
    "serve": "vue-cli-service serve"
  }
}
```

å½“æˆ‘ä»¬è¿è¡Œ `npm run serve` ä¼šæŸ¥æ‰¾ `package.json` ä¸­ `scripts` ä¸­ `key` ä¸º `serve` å¯¹åº”çš„å€¼æ¥å½“ä½œå‘½ä»¤æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äºæ‰§è¡Œäº† `vue-cli-service serve`

è¿™é‡Œæœ‰ä¸€ä¸ª `npm` åŒ…ï¼š`@azzlzzxz/hello_shell`ï¼Œä»–ç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª `hello` å‘½ä»¤ï¼Œæˆ‘ä»¬æ¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ä¸€ä¸‹å®ƒã€‚

```json
// package.json
{
  "name": "demo",
  "scripts": {
    "hello": "hello"
  },
  "dependencies": {
    "@azzlzzxz/hello_shell": "^1.0.0"
  }
}
```

å½“è¿è¡Œ `npm run hello` æ—¶å…¶å®å°±ç›¸å½“äºè¿è¡Œäº† `hello`

é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æ‰§è¡Œ `npm run hello` è€Œä¸ç›´æ¥æ‰§è¡Œ `hello` å‘¢ï¼Ÿ

> `hello` > `zsh: command not found: hello`

ä¸ºä»€ä¹ˆæˆ‘ä»¬ç›´æ¥æ‰§è¡Œ `hello` æ‰¾ä¸åˆ°å‘½ä»¤ï¼Œä½¿ç”¨ `npm run` æ¥æ‰§è¡Œå´å¯ä»¥ï¼Ÿ
åŸå› æ˜¯ `npm run` æ‰§è¡Œè„šæœ¬æ—¶ä¼šå…ˆå» `node_modules/.bin` ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨è¦è¿è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŸ¥æ‰¾ `../node_modules/.bin`ï¼Œå¦‚æœå…¨éƒ½æ‰¾ä¸åˆ°æ‰ä¼šå»æŒ‰ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡æŸ¥æ‰¾ã€‚

![hello.js](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/hello.jpg)

å¥½åœ¨ç°åœ¨ `node` ç»™æˆ‘ä»¬æä¾›äº† `npx` å‘½ä»¤æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿è¡Œ `npx hello` å³å¯è¿è¡Œ `hello` å‘½ä»¤ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥è¿è¡Œ `node_modules/.bin/hello`

> `npx` å¯ä»¥è®©å‘½ä»¤çš„æŸ¥æ‰¾è·¯å¾„ä¸ `npm run` ä¸€è‡´

é‚£ä¹ˆ `node_modules/.bin` ä¸­çš„æ–‡ä»¶ä»å“ªæ¥çš„å‘¢ï¼Ÿ
`npm i @azzlzzxz/hello_shell` æ—¶ä¼šå°† `@azzlzzxz/hello_shell` ä¸­çš„ `package.json` ä¸­çš„ `bin` æŒ‡å®šçš„å‘½ä»¤å’Œæ–‡ä»¶é“¾æ¥åˆ° `node_modules/.bin`ï¼Œä¹Ÿå°±æ˜¯è¯´ `node_modules/.bin/hello` å…¶å®æ˜¯ `node_modules@azzlzzxz/hello_shell/bin/index.js` çš„å¿«æ·æ–¹å¼

```json
// package.json
{
  "name": "@azzlzzxz/hello_shell",
  "version": "1.0.0",
  "description": "ä¸€ä¸ªæè¿°",
  "keywords": [],
  "bin": {
    "hello": "bin/hello_shell.js" // æŒ‡å®šè¿è¡Œ hello å‘½ä»¤æ—¶è¿è¡Œçš„æ–‡ä»¶
  },
  "license": "ISC"
}
```

```js
// bin/index.js
#!/usr/bin/env node
console.log('Hello NPM')
```

å½“è¿è¡Œ `npx hello` æ—¶è‡ªç„¶å°±ç›¸å½“äºè¿è¡Œäº†`@azzlzzxz/hello_shell/bin/index.js`

- å½“æˆ‘ä»¬ä½¿ç”¨ `npm install` å®‰è£…åŒ…æ—¶ï¼Œä¼šå°†è¿™ä¸ªåŒ…ä¸­ `package.json` ä¸­ `bin` ä¸­æŒ‡å®šçš„è„šæœ¬è½¯é“¾æ¥åˆ°é¡¹ç›®çš„ `node_modules/.bin` ä¸‹ï¼Œ`key` ä½œä¸ºé“¾æ¥åå­—ï¼ˆä¹Ÿå°±æ˜¯å‘½ä»¤ï¼‰ï¼Œ`value` ä½œä¸ºå‘½ä»¤è¿è¡Œæ—¶æ‰§è¡Œçš„æ–‡ä»¶

- å½“æˆ‘ä»¬é€šè¿‡ `npm run xxx` è¿è¡ŒæŸä¸ªè„šæœ¬æ—¶ï¼Œä¼šæ‰§è¡Œ `package.json` ä¸­ `scripts` ä¸­æŒ‡å®šçš„è„šæ­¥åçš„å‘½ä»¤ï¼Œä¼šå…ˆå» `node_modules/.bin` ä¸­æŸ¥æ‰¾è¿™äº›å‘½ä»¤ï¼Œç„¶åå» `../node_modules/.bin`,...å…¨éƒ½æ‰¾ä¸åˆ°æ‰ä¼šå»ç¯å¢ƒå˜é‡ä¸­æŸ¥æ‰¾ã€‚

### `npm install`

å‡å¦‚æˆ‘ä»¬ä» `github` ä¸Š `clone` äº†ä¸€ä¸ªé¡¹ç›®ï¼Œä»–çš„ `package.json` æ˜¯è¿™æ ·çš„ï¼š

```json
{
  "name": "demo",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@azzlzzxz/form": "^1.0.4",
    "@azzlzzxz/table": "^1.0.1"
  }
}
```

å½“æˆ‘ä»¬å»è¿è¡Œ `npm install` çš„æ—¶å€™ï¼Œä¼šç»è¿‡ä¸€ä¸‹å‡ æ­¥:

#### æ‰§è¡Œå·¥ç¨‹è‡ªèº« `preinstall` é’©å­

`npm` è·Ÿ `git` ä¸€æ ·éƒ½æœ‰å®Œå–„çš„é’©å­æœºåˆ¶æ•£å¸ƒåœ¨ `npm` è¿è¡Œçš„å„ä¸ªé˜¶æ®µï¼Œå½“å‰ `npm` å·¥ç¨‹å¦‚æœå®šä¹‰äº† `preinstall` é’©å­æ­¤æ—¶ä¼šåœ¨æ‰§è¡Œ `npm install` å‘½ä»¤ä¹‹å‰è¢«æ‰§è¡Œã€‚

```json
// å¦‚ä½•å®šä¹‰é’©å­ï¼šç›´æ¥åœ¨ scripts ä¸­å®šä¹‰å³å¯
// package.json
{
  // ...
  "scripts": {
    "preinstall": "echo \"preinstall hook\"",
    "install": "echo \"install hook\"",
    "postinstall": "echo \"postinstall hook\""
    // ...
  }
  // ...
}
```

å¸¸ç”¨çš„ `npm hooks` åŒ…æ‹¬ï¼š

1. `preinstallï¼š`åœ¨å®‰è£…ä¾èµ–å‰æ‰§è¡Œçš„è„šæœ¬
2. `postinstallï¼š`åœ¨å®‰è£…ä¾èµ–åæ‰§è¡Œçš„è„šæœ¬
3. `prestartï¼š`åœ¨å¯åŠ¨åº”ç”¨å‰æ‰§è¡Œçš„è„šæœ¬
4. `poststartï¼š`åœ¨å¯åŠ¨åº”ç”¨åæ‰§è¡Œçš„è„šæœ¬
5. `pretestï¼šåœ¨`æ‰§è¡Œæµ‹è¯•å‰æ‰§è¡Œçš„è„šæœ¬
6. `posttestï¼š`åœ¨æ‰§è¡Œæµ‹è¯•åæ‰§è¡Œçš„è„šæœ¬
7. `prebuildï¼š`åœ¨æ‰“åŒ…å‰æ‰§è¡Œçš„è„šæœ¬
8. `postbuildï¼š`åœ¨æ‰“åŒ…åæ‰§è¡Œçš„è„šæœ¬
9. `prepublishï¼š`åœ¨å‘å¸ƒå‰æ‰§è¡Œçš„è„šæœ¬
10. `postpublishï¼š`åœ¨å‘å¸ƒåæ‰§è¡Œçš„è„šæœ¬

#### è·å– `package.json` ä¸­ä¾èµ–æ•°æ®æ„å»ºä¾èµ–æ ‘

é¦–å…ˆéœ€è¦åšçš„æ˜¯ç¡®å®šå·¥ç¨‹ä¸­çš„é¦–å±‚ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ `dependencies` å’Œ `devDependencies` å±æ€§ä¸­ç›´æ¥æŒ‡å®šçš„æ¨¡å—ï¼ˆå‡è®¾æ­¤æ—¶æ²¡æœ‰æ·»åŠ  `npm install` çš„å…¶ä»–å‚æ•°ï¼‰ã€‚

> å·¥ç¨‹æœ¬èº«æ˜¯æ•´æ£µä¾èµ–æ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæ¯ä¸ªé¦–å±‚ä¾èµ–æ¨¡å—éƒ½æ˜¯æ ¹èŠ‚ç‚¹ä¸‹é¢çš„ä¸€æ£µå­æ ‘ï¼Œ`npm` ä¼šå¼€å¯å¤šè¿›ç¨‹ä»æ¯ä¸ªé¦–å±‚ä¾èµ–æ¨¡å—å¼€å§‹é€æ­¥å¯»æ‰¾æ›´æ·±å±‚çº§çš„èŠ‚ç‚¹ã€‚

ç¡®å®šå®Œé¦–å±‚ä¾èµ–åï¼Œå°±å¼€å§‹è·å–å„ä¸ªä¾èµ–çš„æ¨¡å—ä¿¡æ¯ï¼Œè·å–æ¨¡å—ä¿¡æ¯æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š

1. è·å–æ¨¡å—ä¿¡æ¯ã€‚åœ¨ä¸‹è½½ä¸€ä¸ªæ¨¡å—ä¹‹å‰ï¼Œé¦–å…ˆè¦ç¡®å®šå…¶ç‰ˆæœ¬ï¼Œè¿™æ˜¯å› ä¸º `package.json` ä¸­å¾€å¾€æ˜¯ `semantic versionï¼ˆsemverï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼‰`ã€‚æ­¤æ—¶å¦‚æœç‰ˆæœ¬æè¿°æ–‡ä»¶ï¼ˆ`npm-shrinkwrap.json` æˆ– `package-lock.json`ï¼‰ä¸­æœ‰è¯¥æ¨¡å—ä¿¡æ¯ç›´æ¥æ‹¿å³å¯ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»ä»“åº“è·å–ã€‚å¦‚ `packaeg.json` ä¸­æŸä¸ªåŒ…çš„ç‰ˆæœ¬æ˜¯ ^1.1.0ï¼Œ`npm` å°±ä¼šå»ä»“åº“ä¸­è·å–ç¬¦åˆ 1.x.x å½¢å¼çš„æœ€æ–°ç‰ˆæœ¬ã€‚

2. è·å–æ¨¡å—å®ä½“ã€‚ä¸Šä¸€æ­¥ä¼šè·å–åˆ°æ¨¡å—çš„å‹ç¼©åŒ…åœ°å€ï¼ˆ`resolved`å­—æ®µï¼‰ï¼Œ`npm`ä¼šç”¨æ­¤åœ°å€æ£€æŸ¥æœ¬åœ°ç¼“å­˜ï¼Œç¼“å­˜ä¸­æœ‰å°±ç›´æ¥æ‹¿ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä»ä»“åº“ä¸‹è½½ã€‚

3. æŸ¥æ‰¾è¯¥æ¨¡å—ä¾èµ–ï¼Œå¦‚æœæœ‰ä¾èµ–åˆ™å›åˆ°ç¬¬ 1 æ­¥ï¼Œå¦‚æœæ²¡æœ‰åˆ™åœæ­¢ã€‚

æœ€ç»ˆä¼šå¾—åˆ°ä¸€ä¸ªç±»ä¼¼ä¸‹å›¾ä¸­çš„ä¾èµ–æ ‘:
![npm](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/npm.jpg)

> å¦‚æœé¡¹ç›®ä¸­å­˜åœ¨ `npm` çš„ `lock` æ–‡ä»¶ï¼ˆä¾‹å¦‚ `package-lock.json`ï¼‰ï¼Œåˆ™ä¸ä¼šä»å¤´å¼€å§‹æ„å»ºä¾èµ–æ ‘ï¼Œè€Œæ˜¯å¯¹ `lock` ä¸­ä¾èµ–æ ‘ä¸­å­˜å‚¨å†²çªçš„ä¾èµ–è¿›è¡Œè°ƒæ•´å³å¯

#### ä¾èµ–æ ‘æ‰å¹³åŒ–ï¼ˆdedupeï¼‰

ä¸Šä¸€æ­¥è·å–åˆ°çš„æ˜¯ä¸€æ£µå®Œæ•´çš„ä¾èµ–æ ‘ï¼Œå…¶ä¸­å¯èƒ½åŒ…å«å¤§é‡é‡å¤æ¨¡å—ã€‚æ¯”å¦‚ `form` æ¨¡å—ä¾èµ–äº `antd`, `table` æ¨¡å—åŒæ ·ä¾èµ–äº `antd`ã€‚åœ¨ `npm3` ä»¥å‰ä¼šä¸¥æ ¼æŒ‰ç…§ä¾èµ–æ ‘çš„ç»“æ„è¿›è¡Œå®‰è£…ï¼Œä¹Ÿå°±æ˜¯æ–¹ä¾¿åœ¨ `form` å’Œ `table` çš„ `node_modules` ä¸­å„å®‰è£…ä¸€ä»½ï¼Œå› æ­¤ä¼šé€ æˆæ¨¡å—å†—ä½™ã€‚

â€‹ ä» `npm3` å¼€å§‹é»˜è®¤åŠ å…¥äº†ä¸€ä¸ª `dedupe` çš„è¿‡ç¨‹ã€‚å®ƒä¼šéå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€ä¸ªå°†æ¨¡å—æ”¾åœ¨æ ¹èŠ‚ç‚¹ä¸‹é¢ï¼Œä¹Ÿå°±æ˜¯ `node_modules` çš„ç¬¬ä¸€å±‚ã€‚å½“å‘ç°æœ‰é‡å¤æ¨¡å—æ—¶ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒã€‚

ç»è¿‡ä¼˜åŒ–åçš„ä¾èµ–æ ‘å°±æ˜¯å˜æˆäº†ä¸‹é¢è¿™æ ·:
![npm_opt](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/npm_opt.jpg)

> è€Œ `lock` æ–‡ä»¶ä¸­å­˜å‚¨çš„æ­£æ˜¯è¿™é¢—è¢«ä¼˜åŒ–åçš„ä¾èµ–æ ‘ã€‚

è¿™é‡Œéœ€è¦å¯¹é‡å¤æ¨¡å—è¿›è¡Œä¸€ä¸ªå®šä¹‰ï¼Œå®ƒæŒ‡çš„æ˜¯æ¨¡å—åç›¸åŒä¸” `semver(è¯­ä¹‰åŒ–ç‰ˆæœ¬)` å…¼å®¹ã€‚æ¯ä¸ª `semver` éƒ½å¯¹åº”ä¸€æ®µç‰ˆæœ¬å…è®¸èŒƒå›´ï¼Œå¦‚æœä¸¤ä¸ªæ¨¡å—çš„ç‰ˆæœ¬å…è®¸èŒƒå›´å­˜åœ¨äº¤é›†ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå…¼å®¹ç‰ˆæœ¬ï¼Œè€Œä¸å¿…ç‰ˆæœ¬å·å®Œå…¨ä¸€è‡´ï¼Œè¿™å¯ä»¥ä½¿æ›´å¤šå†—ä½™æ¨¡å—åœ¨ `dedupe` è¿‡ç¨‹ä¸­è¢«å»æ‰ã€‚

æ¯”å¦‚ `node_modules` ä¸‹ `form` æ¨¡å—ä¾èµ– `antd@^4.0.0`ï¼Œ`tale` æ¨¡å—ä¾èµ– `antd@^4.1.0`ï¼Œåˆ™ >=4.1.0 çš„ç‰ˆæœ¬éƒ½ä¸ºå…¼å®¹ç‰ˆæœ¬ã€‚

è€Œå½“ `foo` ä¾èµ– `antd@^5.0.0`ï¼Œ`bar` ä¾èµ– `antd@^4.1.0`ï¼Œåˆ™ä¾æ® `semver` çš„è§„åˆ™ï¼ŒäºŒè€…ä¸å­˜åœ¨å…¼å®¹ç‰ˆæœ¬ã€‚ä¼šå°†ä¸€ä¸ªç‰ˆæœ¬æ”¾åœ¨é¦–å±‚ä¾èµ–ä¸­ï¼Œå¦ä¸€ä¸ªä»ä¿ç•™åœ¨å…¶çˆ¶é¡¹ï¼ˆ`foo` æˆ–è€… `bar`ï¼‰çš„ä¾èµ–æ ‘é‡Œã€‚

ä¸¾ä¸ªæ —å­ ğŸŒ°ï¼Œå‡è®¾ä¸€ä¸ªä¾èµ–æ ‘åŸæœ¬æ˜¯è¿™æ ·:

```lua
node_modules
|--form
   |-- antd@version1
|--table
   |-- antd@version2
```

å‡è®¾ `version1` å’Œ `version2` æ˜¯å…¼å®¹ç‰ˆæœ¬ï¼Œåˆ™ç»è¿‡ dedupe ä¼šæˆä¸ºä¸‹é¢çš„å½¢å¼ï¼š

```lua
node_modules
|--form
|--table
|--antdï¼ˆä¿ç•™çš„ç‰ˆæœ¬ä¸ºå…¼å®¹ç‰ˆæœ¬ï¼‰
```

å‡è®¾ `version1` å’Œ `version2` ä¸ºéå…¼å®¹ç‰ˆæœ¬ï¼Œåˆ™åé¢çš„ç‰ˆæœ¬ä¿ç•™åœ¨ä¾èµ–æ ‘ä¸­ï¼š

```lua
node_modules
|--form
|--antd@version1
|--table
   |-- antd@version2
```

#### å®‰è£…æ¨¡å—

è¿™ä¸€æ­¥å°†ä¼šæŒ‰ç…§ä¾èµ–æ ‘ä¸‹è½½/è§£å‹åŒ…ï¼Œå¹¶æ›´æ–°å·¥ç¨‹ä¸­çš„ `node_modules`ã€‚

![update_node_modules](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/update_node_modules.jpg)

### `npm ci`

`npm ci` å‘½ä»¤å¯ä»¥å®Œå…¨å®‰è£… `lock` æ–‡ä»¶æè¿°çš„ä¾èµ–æ ‘æ¥å®‰è£…ä¾èµ–ï¼Œå¯ä»¥ç”¨å®ƒæ¥é¿å…æ‰å¹³åŒ–é€ æˆçš„ `node_modules` ç»“æ„ä¸ç¡®å®šçš„é—®é¢˜ã€‚

**`npm ci`** å’Œ **`npm i`** ä¸ä»…ä»…æ˜¯æ˜¯å¦ä½¿ç”¨ `package-lock.json` çš„åŒºåˆ«ï¼Œ`npm ci` ä¼šåˆ é™¤ `node_modules` ä¸­æ‰€æœ‰çš„å†…å®¹å¹¶ä¸”æ¯«æ— äºŒå¿ƒçš„æŒ‰ç…§ `package-lock.json` çš„ç»“æ„æ¥å®‰è£…å’Œä¿å­˜åŒ…ï¼Œä»–çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯ä»»ä½•æƒ…å†µä¸‹äº§ç”Ÿçš„ `node_modules` ç»“æ„éƒ½ä¸€è‡´çš„ã€‚è€Œ npm i ä¸ä¼šåˆ é™¤ `node_modules`ï¼ˆå¦‚æœ `node_modules` å·²ç»å­˜åœ¨æŸä¸ªåŒ…å°±ä¸ä¼šé‡æ–°ä¸‹è½½äº†ï¼‰ã€å¹¶ä¸”å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½è¿˜ä¼šè°ƒæ•´å¹¶ä¿®æ”¹ `package-lock.json` çš„å†…å®¹

> å®é™…é¡¹ç›®ä¸­å»ºè®®å°† `lock` ä¹Ÿæ·»åŠ åˆ° `git` ä¸­ï¼Œå°½é‡ä½¿ç”¨ `npm ci` æ¥å®‰è£…ä¾èµ–ï¼Œå¦‚æœæœ‰ä¾èµ–éœ€è¦ä¿®æ”¹çš„ï¼Œå¯ä»¥é€šè¿‡ `npm install xxx@xxx` æ¥å®‰è£…æŒ‡å®šä¾èµ–çš„æŒ‡å®šç‰ˆæœ¬ï¼Œè¿™æ ·åªä¼šè°ƒæ•´ `lock` æ–‡ä»¶ä¸­æŒ‡å®šä¾èµ–çš„ä¾èµ–æ ‘ï¼Œä¸ä¼šä¿®æ”¹å…¶ä»–ä¾èµ–çš„ä¾èµ–æ ‘ã€‚

### `npm cache clean â€“force`

æ˜¯å¼ºåˆ¶æ¸…é™¤`~/.npm`ç›®å½•ä¸‹çš„å‹ç¼©åŒ…ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰

## `package-lock.json`

èƒŒæ™¯

`npm` ä½¿ç”¨ `semver` ç‰ˆæœ¬æ§åˆ¶ï¼Œæ–¹ä¾¿å¼€å‘è€…ä½¿ç”¨ç‰¹å®šçš„ç‰ˆæœ¬è·Ÿè¸ªç­–ç•¥ï¼Œæ¯”å¦‚ï¼šè‡ªåŠ¨æ›´æ–°ä¸€äº›ç‰ˆæœ¬ï¼ˆbug ä¿®å¤ç­‰ï¼‰
ä½†æ˜¯ `npm semver` ç‰ˆæœ¬æ§åˆ¶ç­–ç•¥å¯èƒ½å¯¼è‡´ä¸€äº›é—®é¢˜ï¼š

1. å›¢é˜Ÿå†…ä¸åŒçš„é˜Ÿå‹`ï¼ˆteammatesï¼‰`å¯èƒ½å®é™…ä¸Šä¾èµ–çš„ç‰ˆæœ¬å¹¶ä¸ä¸€è‡´
2. æœ¬åœ°å¼€å‘ç¯å¢ƒæˆ–è€…å…¶ä»–ç¯å¢ƒé˜¶æ®µå®‰è£…çš„ä¾èµ–ä¸ä¸€è‡´
3. è¿™äº›è¿è¡Œæ—¶ç¯å¢ƒä¸ä¸€è‡´çš„é—®é¢˜ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´æœ¬åœ°æˆ–è€…æµ‹è¯•ç¯å¢ƒèƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ä»£ç ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å´äº§ç”Ÿäº†å¼‚å¸¸ã€‚

ä¸ºäº†è¾¾åˆ°ä¸åŒæˆå‘˜ã€ä¸åŒç¯å¢ƒçš„ä¾èµ–ä¿æŒä¸€è‡´çš„æ•ˆæœï¼Œé‡‡ç”¨äº† `package-lock.json` æ¥é”å®šç‰¹å®šçš„ç‰ˆæœ¬ã€‚

`package-lock.json` ç»„æˆ

```json
{
  "name": "assets-system", //å’Œpackage.jsonä¸­nameä¿æŒä¸€è‡´
  "version": "0.1.0", // å’Œpackage.jsonä¸­nameä¿æŒä¸€è‡´
  "lockfileVersion": 1,
  "requires": true,
  "packages": {},
  "dependencies": [] //å½“å‰åŒ…çš„ä¾èµ–é”å®šä¾èµ–æ ‘
}
```

éƒ¨åˆ†å­—æ®µè¯´æ˜ï¼š

```json
"react": {
  "version": "18.2.0",
  "resolved": "http://nexus.fenxianglife.com/repository/npm-public/react/-/react-18.2.0.tgz",
  "integrity": "sha512-/3IjMdb2L9QbBdWiW5e3P2/npwMBaU9mHCSCUzNln0ZCYbcfTsGbTJrU/kGemdH2IWmB2ioZ+zkxtmq6g09fGQ==",
  "requires": {
    "loose-envify": "^1.1.0"
  }
},
```

1. `resolvedï¼š`ä¾èµ–åŒ…çš„ä¸‹è½½åœ°å€ï¼Œå¯¹åº”ä½¿ç”¨ `npm registry` å®‰è£…çš„ä¾èµ–ã€‚
2. `integrityï¼š`æ˜¯ç”¨æ¥éªŒè¯èµ„æºçš„å®Œæ•´æ€§ï¼Œå³æ˜¯å¦æ˜¯æˆ‘æœŸæœ›åŠ è½½çš„èµ„æºï¼Œè€Œä¸æ˜¯è¢«åˆ«äººç¯¡æ”¹äº†å†…å®¹ã€‚

## `npm` å­˜åœ¨çš„é—®é¢˜

### ä¾èµ–ç»“æ„ä¸ç¡®å®š

å‡å¦‚é¡¹ç›®ä¾èµ–ä¸¤ä¸ªåŒ… `express` å’Œ `koa`ï¼Œè¿™ä¸¤ä¸ªåŒ…çš„ä¾èµ–åˆæ˜¯è¿™æ ·çš„:

![depend_one](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/depend_one.jpg)

é‚£ä¹ˆ `npm install` çš„æ—¶å€™ï¼Œé€šè¿‡æ‰å¹³åŒ–å¤„ç†ä¹‹åï¼Œç©¶ç«Ÿæ˜¯è¿™æ ·:

![depend_second](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/depend_second.jpg)

è¿˜æ˜¯è¿™æ ·:

![depend_three](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/depend_three.jpg)

ç­”æ¡ˆæ˜¯: éƒ½æœ‰å¯èƒ½ã€‚å–å†³äº `express` å’Œ `koa` åœ¨ `package.json` ä¸­çš„ä½ç½®ï¼Œå¦‚æœ `express` å£°æ˜åœ¨å‰é¢ï¼Œé‚£ä¹ˆå°±æ˜¯å‰é¢çš„ç»“æ„ï¼Œå¦åˆ™æ˜¯åé¢çš„ç»“æ„ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿä¾èµ–ç»“æ„çš„ä¸ç¡®å®šé—®é¢˜ï¼Œä¹Ÿæ˜¯ `lock` æ–‡ä»¶è¯ç”Ÿçš„åŸå› ä¹‹ä¸€ï¼Œæ— è®ºæ˜¯ `package-lock.json(npm 5.x æ‰å‡ºç°)`è¿˜æ˜¯ `yarn.lock`ï¼Œéƒ½æ˜¯ä¸ºäº†ä¿è¯ `install` ä¹‹åéƒ½äº§ç”Ÿç¡®å®šçš„ `node_modules` ç»“æ„ã€‚

### æ‰å¹³åŒ–å¯¼è‡´å¯ä»¥éæ³•è®¿é—®æ²¡æœ‰å£°æ˜è¿‡ä¾èµ–çš„åŒ…ï¼ˆå¹½çµä¾èµ–ï¼‰

â€œå¹½çµä¾èµ–â€ æŒ‡çš„æ˜¯é¡¹ç›®ä»£ç ä¸­ä½¿ç”¨äº†ä¸€äº›æ²¡æœ‰è¢«å®šä¹‰åœ¨å…¶ `package.json` æ–‡ä»¶ä¸­çš„åŒ…ã€‚

è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ï¼š

```json
// package.json
{
  "name": "demo",
  "main": "index.js",
  "dependencies": {
    "express": "^3.0.4"
  }
}
```

ä½†å‡è®¾ä»£ç æ˜¯è¿™æ ·ï¼š

```json
// index.js
const cookie = require("cookie");  // ???

// ï¼ˆæ›´å¤šä½¿ç”¨é‚£äº›åº“çš„ä»£ç )

// ï¼ˆæ›´å¤šä½¿ç”¨é‚£äº›åº“çš„ä»£ç )
```

è¿™ä¸ªåº“æ ¹æœ¬æ²¡æœ‰è¢«ä½œä¸ºä¾èµ–å®šä¹‰åœ¨ `package.json` æ–‡ä»¶ä¸­ã€‚é‚£è¿™åˆ°åº•æ˜¯æ€ä¹ˆè·‘èµ·æ¥çš„å‘¢ï¼Ÿ
åŸæ¥ `cookie` æ˜¯ `express` çš„ä¾èµ–ï¼Œåœ¨å®‰è£…çš„æ—¶å€™ï¼ŒNPM ä¼šæ‰“å¹³ä»–ä»¬çš„æ–‡ä»¶å¤¹åˆ° `node_modules`ã€‚`NodeJS`çš„ `require()`å‡½æ•°èƒ½å¤Ÿåœ¨ä¾èµ–ç›®å½•æ‰¾åˆ°å®ƒä»¬ï¼Œå› ä¸º `require()`åœ¨æŸ¥æ‰¾æ–‡ä»¶å¤¹æ—¶ æ ¹æœ¬ä¸ä¼šå— `package.json` æ–‡ä»¶ å½±å“ã€‚

è¿™æ˜¯å¾ˆä¸å®‰å…¨çš„ï¼Œå½“æœªæ¥ `express` ä¸­ä¸å†ä¾èµ– `cookie` æ—¶å°†ä¼šå¯¼è‡´é¡¹ç›®æŠ¥é”™ï¼Œå› ä¸ºé‚£æ—¶å¦‚æœæ•´ä¸ªé¡¹ç›®å¯èƒ½æ²¡æœ‰å¦‚ä½•åŒ…ä¾èµ–äº† `cookie`ï¼Œä¹Ÿå°±ä¸ä¼šåœ¨é¡¶å±‚ä¾èµ–æ ‘ä¸­æœ‰ `cookie`ï¼Œæ‰€ä»¥é¡¹ç›®ä¸€å®šä¼šå› ä¸ºæ‰¾ä¸åˆ° `cookie` è¿™ä¸ªåŒ…è€ŒæŠ¥é”™ã€‚

### åˆæ…¢åˆå¤§

#### åˆ†æä¾èµ–æ ‘

`npm` åœ¨åˆ†æä¾èµ–æ ‘çš„æ—¶å€™ä¼šå…ˆå¹¶è¡Œå‘å‡ºé¡¹ç›®é¡¶çº§çš„ä¾èµ–è§£æè¯·æ±‚ï¼Œå½“æŸä¸€ä¸ªè¯·æ±‚å›æ¥æ—¶ï¼Œåœ¨å»è¯·æ±‚èµ·æ‰€æœ‰çš„å­ä¾èµ–ï¼Œç›´åˆ°ä¸å­˜åœ¨ä¾èµ–ä¸ºæ­¢ï¼Œç”±äºæ¯ä¸€ä¸ªæ ‘éƒ½éœ€è¦æ ¹èŠ‚ç‚¹çš„ä¾èµ–è§£æè¯·æ±‚åæ‰èƒ½å¼€å§‹è§£æå…¶å­æ ‘ï¼Œå¦‚æœä¾èµ–æ ‘æ·±åº¦æ¯”è¾ƒæ·±å°±ä¼šå¯¼è‡´ç­‰å¾…æ—¶é—´è¿‡é•¿

![deped_four](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/depend_four.jpg)

é€’å½’çš„åˆ†æä¾èµ–æ ‘éœ€è¦éå¸¸å¤§é‡çš„ `http` è¯·æ±‚ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä¾èµ–æ ‘æ„å»ºæ—¶é—´è¿‡é•¿

è¿™é‡Œæ¨èä¸€ä¸ªåˆ†æä¾èµ–æ ‘çš„å·¥å…· `npm-remote-ls`

å¯è§†åŒ–ä¾èµ–å…³ç³»ï¼š[npm.anvaka](https://npm.anvaka.com/#/)

#### å¤§é‡æ–‡ä»¶ä¸‹è½½/è§£å‹

å› ä¸º `npm` ä¸‹è½½çš„å†…å®¹æ˜¯ä¸€ä¸ªä¸ªå‹ç¼©åŒ…ï¼Œè§£å‹åæ–‡ä»¶æ•°é‡å¤šï¼Œéœ€è¦å¤§é‡çš„ `IO` æ“ä½œï¼ˆåˆ›å»ºæ–‡ä»¶å¤¹ã€åˆ›å»ºæ–‡ä»¶ã€å†™å…¥æ–‡ä»¶...ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å¯¼è‡´ `npm` æ…¢çš„ä¸»è¦åŸå› ã€‚

#### ä¾ç„¶å¯èƒ½å­˜åœ¨å¤§é‡é‡å¤åŒ…

æ‰å¹³åŒ–åªèƒ½ä¼šåœ¨é¦–æ¬¡é‡åˆ°ä¸€ä¸ªåŒ…æ—¶æ‰ä¼šå°†å…¶æå‡åˆ°é¡¶éƒ¨ï¼Œå¦‚æœé¡¹ç›®ä¸­æœ‰ `A`ã€`B`ã€`C` ä¸‰ä¸ªåŒ…åˆ†åˆ«ä¾èµ–äº†`D@1.0.0`ã€`D@2.0.0`ã€`D@2.0.1`ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šäº§ç”Ÿ`D@1.0.0`è¢«æå‡ï¼Œ`D@2.0.0`å‡ºç°åœ¨ `B`ã€`C` çš„ `node_modelus` çš„æƒ…å†µã€‚
