# å‡½æ•°å¼ç¼–ç¨‹

## çº¯å‡½æ•°

- å¯¹äºç›¸åŒçš„è¾“å…¥ï¼Œæ€»æ˜¯ä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡º
- åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ²¡æœ‰è¯­ä¹‰ä¸Šå¯è§‚å¯Ÿçš„å‰¯ä½œç”¨

:::tip
è¾“å…¥åªèƒ½å¤Ÿä»¥å‚æ•°å½¢å¼ä¼ å…¥ï¼Œè¾“å‡ºåªèƒ½å¤Ÿä»¥è¿”å›å€¼å½¢å¼ä¼ é€’ï¼Œé™¤äº†å…¥å‚å’Œè¿”å›å€¼ä¹‹å¤–ï¼Œä¸ä»¥ä»»ä½•å…¶å®ƒå½¢å¼å’Œå¤–ç•Œè¿›è¡Œæ•°æ®äº¤æ¢çš„å‡½æ•°ã€‚
:::

### å‰¯ä½œç”¨

å‡½æ•°å‰¯ä½œç”¨æŒ‡å½“è°ƒç”¨å‡½æ•°æ—¶ï¼Œé™¤äº†è¿”å›å¯èƒ½çš„å‡½æ•°å€¼ä¹‹å¤–ï¼Œè¿˜å¯¹ä¸»è°ƒç”¨å‡½æ•°äº§ç”Ÿé™„åŠ çš„å½±å“

:::tip
å¦‚æœä¸€ä¸ªå‡½æ•°é™¤äº†è®¡ç®—ä¹‹å¤–ï¼Œè¿˜å¯¹å®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€æ‰§è¡Œå®¿ä¸»ç­‰å¤–éƒ¨ç¯å¢ƒé€ æˆäº†ä¸€äº›å…¶å®ƒçš„å½±å“ï¼Œé‚£ä¹ˆè¿™äº›å½±å“å°±æ˜¯æ‰€è°“çš„â€å‰¯ä½œç”¨â€ã€‚
:::

## å‡½æ•°çš„`çº¯`ä¸`ä¸çº¯`

`çº¯`çš„æœ¬è´¨â€”â€”æœ‰ä¸”ä»…æœ‰ã€æ˜¾å¼æ•°æ®æµã€‘

### æ˜¾ç¤ºæ•°æ®æµ

çº¯å‡½æ•°ï¼šè¾“å…¥è¾“å‡ºæ•°æ®æµå…¨æ˜¯æ˜¾å¼`ï¼ˆExplicitï¼‰`çš„å‡½æ•°

æ˜¾ç¤ºæ•°æ®æµï¼šæ˜¾å¼æ•°æ®æµæ„å‘³ç€å‡½æ•°é™¤äº†å…¥å‚å’Œè¿”å›å€¼ä¹‹å¤–ï¼Œä¸ä»¥ä»»ä½•å…¶å®ƒå½¢å¼ä¸å¤–ç•Œè¿›è¡Œæ•°æ®äº¤æ¢ã€‚

`ä¸çº¯`çš„å…ƒå‡¶â€”â€”éšå¼æ•°æ®æµï¼Œä»£è¡¨ç€å‡½æ•°å’Œå¤–ç•Œå­˜åœ¨æ•°æ®äº¤æ¢ã€‚

## å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘

> å¦‚æœä¸€é—¨ç¼–ç¨‹è¯­è¨€å°†å‡½æ•°å½“åšä¸€ç­‰å…¬æ°‘å¯¹å¾…ï¼Œé‚£ä¹ˆè¿™é—¨è¯­è¨€è¢«ç§°ä½œâ€œæ‹¥æœ‰å¤´ç­‰å‡½æ•°

- å¯ä»¥è¢«å½“ä½œå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°
- å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼
- å¯ä»¥è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡

## ä¸å¯å˜çš„å€¼ï¼Œå¯å˜çš„å¼•ç”¨å†…å®¹

å€¼ç±»å‹çš„æ•°æ®æ— æ³•è¢«ä¿®æ”¹ï¼Œåƒæ•°å­—ç±»å‹è¿™æ ·ï¼Œè‡ªåˆ›å»ºèµ·å°±æ— æ³•å†è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º`ä¸å¯å˜æ•°æ®`ã€‚

```js
let a = 1
let b = a

// true
a === b

b = 2

// false
a === b
```

åˆ›å»ºåä»ç„¶å¯ä»¥è¢«ä¿®æ”¹çš„æ•°æ®ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º`å¯å˜æ•°æ®`ã€‚

```js
const a = {
  name: 'xiuyan',
  age: 30,
}

const b = a

// true
a === b

b.name = 'youhu'

// true
a === b
```

## å¦‚ä½•å®ç°ä¸å¯å˜æ•°æ®

è¦æƒ³å†™å‡ºå¥½çš„å‡½æ•°å¼ä»£ç ï¼Œå°±éœ€è¦ç¡®ä¿æ•°æ®çš„ä¸å¯å˜æ€§ã€‚

### `const`

`const` åªèƒ½å¤Ÿä¿è¯å€¼ç±»å‹æ•°æ®çš„ä¸å˜æ€§ï¼Œå´ä¸èƒ½å¤Ÿä¿è¯å¼•ç”¨ç±»å‹æ•°æ®çš„ä¸å˜æ€§ã€‚

```js
const price = 10

price = 20 // Uncaught TypeError: Assignment to constant variable.
```

`const` ç”Ÿä¸‹æ¥å°±æ˜¯ä¸“é—¨é˜»æ­¢ä½ åš `reassign` è¿™ä¸ªåŠ¨ä½œçš„ï¼Œä½†å¯¹äºå¼•ç”¨ç±»å‹æ¥è¯´ï¼Œå°±ç®—å µä½äº† `reassign`ï¼Œä¹Ÿä¸å½±å“æˆ‘ä»¬ä¿®æ”¹æ•°æ®çš„å†…å®¹ï¼Œå› æ­¤ï¼Œå¯¹äºå­˜å‚¨å€¼ç±»å‹æ•°æ®çš„å˜é‡æ¥è¯´ï¼Œ`const` ç¡®å®èƒ½å¤Ÿç¡®ä¿å…¶å†…å®¹çš„ä¸å˜æ€§ã€‚

```js
const my = {
  name: 'steins gate',
  age: 28,
}

// è¿™ä¸€è¡Œä¸ä¼šæŠ¥é”™
me.age = 18

console.log(my)
```

### æ‹·è´

æ‹·è´çš„ç›®çš„ï¼šç¡®ä¿å¤–éƒ¨æ•°æ®çš„åªè¯»æ€§ã€‚

å¯¹äºå‡½æ•°å¼ç¼–ç¨‹æ¥è¯´ï¼Œå‡½æ•°çš„å¤–éƒ¨æ•°æ®æ˜¯åªè¯»çš„ï¼Œå‡½æ•°çš„å†…éƒ¨æ•°æ®åˆ™æ˜¯å¯å†™çš„ã€‚

å¯¹äºä¸€ä¸ªå‡½æ•°æ¥è¯´ï¼Œâ€å¤–éƒ¨æ•°æ®â€œå¯ä»¥åŒ…æ‹¬å…¨å±€å˜é‡ã€æ–‡ä»¶ç³»ç»Ÿæ•°æ®ã€æ•°æ®åº“æ•°æ®ã€ç½‘ç»œå±‚æ•°æ®ç­‰ã€‚æœ‰ä¸”ä»…æœ‰è¿™äº›å¤–éƒ¨æ•°æ®ï¼Œå­˜åœ¨ã€åªè¯»ã€‘çš„å¿…è¦ã€‚

> æ³¨ï¼šç”±äºçº¯å‡½æ•°åªèƒ½é€šè¿‡å‚æ•°è·å–æ•°æ®ï¼Œå› æ­¤å¦‚æœéœ€è¦ä½¿ç”¨å¤–éƒ¨æ•°æ®ï¼Œå°±å¿…é¡»å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚

### `Immutable.js`

æŒä¹…åŒ–æ•°æ®ç»“æ„çš„ç²¾é«“åŒæ ·åœ¨äºâ€œæ•°æ®å…±äº«â€ã€‚

æ•°æ®å…±äº«æ„å‘³ç€å°†â€œå˜ä¸ä¸å˜â€åˆ†ç¦»ï¼Œç¡®ä¿åªæœ‰å˜åŒ–çš„éƒ¨åˆ†è¢«å¤„ç†ï¼Œè€Œä¸å˜çš„éƒ¨åˆ†åˆ™å°†ç»§ç»­ç•™åœ¨åŸåœ°ã€è¢«æ–°çš„æ•°æ®ç»“æ„æ‰€å¤ç”¨ã€‚

ä¸åŒçš„æ˜¯ï¼Œåœ¨ `git` ä¸–ç•Œé‡Œï¼Œè¿™ä¸ªâ€œå˜ä¸ä¸å˜â€çš„åŒºåˆ†æ˜¯æ–‡ä»¶çº§åˆ«çš„ï¼›è€Œåœ¨ `Immutable.js` çš„ä¸–ç•Œé‡Œï¼Œè¿™ä¸ªâ€œå˜ä¸ä¸å˜â€å¯ä»¥ç»†åŒ–åˆ°æ•°ç»„çš„æŸä¸€ä¸ªå…ƒç´ ã€å¯¹è±¡çš„æŸä¸€ä¸ªå­—æ®µã€‚

ä¸¾ä¸ª ğŸŒ°ï¼š

```js
const dataA = Map({
  do: 'coding',
  age: 333,
  from: 'a',
  to: 'b',
})
```

```js
// ä½¿ç”¨ immutable æš´éœ²çš„ Api æ¥ä¿®æ”¹ baseMap çš„å†…å®¹
const dataB = dataA.set({
  age: 33.3,
})
```

![Immutable](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/Immutable.jpg)

ä¸ºäº†è¾¾åˆ°è¿™ç§â€œæ•°æ®å…±äº«â€çš„æ•ˆæœï¼ŒæŒä¹…åŒ–æ•°æ®ç»“æ„åœ¨åº•å±‚ä¾èµ–äº†ä¸€ç§ç»å…¸çš„åŸºç¡€æ•°æ®ç»“æ„ï¼Œé‚£å°±æ˜¯ `Trie`(å­—å…¸æ ‘ï¼‰

### `Immer.js`

**API**

```js
import produce from 'immer'

// è¿™æ˜¯æˆ‘çš„æºæ•°æ®
const baseState = [
  {
    name: 'steins gate',
    age: 99,
  },
  {
    name: 'azzlzzxz',
    age: 100,
  },
]

// å®šä¹‰æ•°æ®çš„å†™é€»è¾‘
const recipe = (draft) => {
  draft.push({ name: 'person', age: 101 })
  draft[1].age = 102
}

// å€ŸåŠ© produceï¼Œæ‰§è¡Œæ•°æ®çš„å†™é€»è¾‘
const nextState = produce(baseState, recipe)
```

- `(base)state`ï¼šæºæ•°æ®ï¼Œæ˜¯æˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„ç›®æ ‡æ•°æ®
- `recipe`ï¼šä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æè¿°æ•°æ®çš„å†™é€»è¾‘
- `draft` ï¼š`recipe` å‡½æ•°çš„é»˜è®¤å…¥å‚ï¼Œå®ƒæ˜¯å¯¹æºæ•°æ®çš„ä»£ç†ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæƒ³è¦åº”ç”¨åœ¨æºæ•°æ®çš„å˜æ›´åº”ç”¨åœ¨ `draft` ä¸Š
- `produce`ï¼šå…¥å£å‡½æ•°ï¼Œå®ƒè´Ÿè´£æŠŠä¸Šè¿°è¦ç´ ä¸²èµ·æ¥ã€‚å…·ä½“é€»è¾‘è¯·çœ‹ä¸‹æ–‡åˆ†è§£ã€‚

---

`Immer.js` å®ç° `Immutability` çš„å§¿åŠ¿éå¸¸æœ‰è¶£â€”â€”å®ƒä½¿ç”¨ `Proxy`ï¼Œå¯¹ç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºè¿›è¡Œâ€œå…ƒç¼–ç¨‹â€ã€‚

> `Proxy` å¯¹è±¡ç”¨äºåˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ç†ï¼Œä»è€Œå®ç°åŸºæœ¬æ“ä½œçš„æ‹¦æˆªå’Œè‡ªå®šä¹‰ï¼ˆå¦‚å±æ€§æŸ¥æ‰¾ã€èµ‹å€¼ã€æšä¸¾ã€å‡½æ•°è°ƒç”¨ç­‰ï¼‰ã€‚ â€”â€”MDN

`Immer.js` çš„ä¸€åˆ‡å¥¥ç§˜éƒ½è•´å«åœ¨ `produce` é‡Œï¼ŒåŒ…æ‹¬å…¶å¯¹ `Proxy` çš„è¿ç”¨ã€‚

é‚£ä¹ˆ `produce` æ˜¯å¦‚ä½•å·¥ä½œçš„å‘¢ï¼Ÿ

`Immer.js` çš„æºä»£ç è™½ç„¶ç®€æ´ï¼Œä½†æ•´ä¸ªè¯»å®Œä¹Ÿæ˜¯ä¸ªåŠ›æ°”æ´»ã€‚è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ `produce` å‡½æ•°çš„æ ¸å¿ƒé€»è¾‘ï¼Œæˆ‘å°†å…¶æå–ä¸ºå¦‚ä¸‹çš„æç®€ç‰ˆæœ¬ï¼š

```js
function produce(base, recipe) {
  // é¢„å®šä¹‰ä¸€ä¸ª copy å‰¯æœ¬
  let copy
  // å®šä¹‰ base å¯¹è±¡çš„ proxy handler
  const baseHandler = {
    set(obj, key, value) {
      // å…ˆæ£€æŸ¥ copy æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»º copy
      if (!copy) {
        copy = { ...base }
      }
      // å¦‚æœ copy å­˜åœ¨ï¼Œä¿®æ”¹ copyï¼Œè€Œä¸æ˜¯ base
      copy[key] = value
      return true
    },
  }

  // è¢« proxy åŒ…è£…åçš„ base è®°ä¸º draft
  const draft = new Proxy(base, baseHandler)
  // å°† draft ä½œä¸ºå…¥å‚ä¼ å…¥ recipe
  recipe(draft)
  // è¿”å›ä¸€ä¸ªè¢«â€œå†»ç»“â€çš„ copyï¼Œå¦‚æœ copy ä¸å­˜åœ¨ï¼Œè¡¨ç¤ºæ²¡æœ‰æ‰§è¡Œå†™æ“ä½œï¼Œè¿”å› base å³å¯
  // â€œå†»ç»“â€æ˜¯ä¸ºäº†é¿å…æ„å¤–çš„ä¿®æ”¹å‘ç”Ÿï¼Œè¿›ä¸€æ­¥ä¿è¯æ•°æ®çš„çº¯åº¦
  return Object.freeze(copy || base)
}
```

```js
// è¿™æ˜¯æˆ‘çš„æºå¯¹è±¡
const baseObj = {
  a: 1,
  b: {
    name: 'azzlzzxz',
  },
}

// è¿™æ˜¯ä¸€ä¸ªæ‰§è¡Œå†™æ“ä½œçš„ recipe
const changeA = (draft) => {
  draft.a = 2
}

// è¿™æ˜¯ä¸€ä¸ªä¸æ‰§è¡Œå†™æ“ä½œã€åªæ‰§è¡Œè¯»æ“ä½œçš„ recipe
const doNothing = (draft) => {
  console.log('doNothing function is called, and draft is', draft)
}

// å€ŸåŠ© produceï¼Œå¯¹æºå¯¹è±¡åº”ç”¨å†™æ“ä½œï¼Œä¿®æ”¹æºå¯¹è±¡é‡Œçš„ a å±æ€§
const changedObjA = produce(baseObj, changeA)

// å€ŸåŠ© produceï¼Œå¯¹æºå¯¹è±¡åº”ç”¨è¯»æ“ä½œ
const doNothingObj = produce(baseObj, doNothing)

// é¡ºåºè¾“å‡º3ä¸ªå¯¹è±¡ï¼Œç¡®è®¤å†™æ“ä½œç¡®å®ç”Ÿæ•ˆäº†
console.log(baseObj)
console.log(changedObjA)
console.log(doNothingObj)

// ã€æºå¯¹è±¡ã€‘ å’Œ ã€å€ŸåŠ© produce å¯¹æºå¯¹è±¡æ‰§è¡Œè¿‡è¯»æ“ä½œåçš„å¯¹è±¡ã€‘ è¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡å—ï¼Ÿ
// ç­”æ¡ˆä¸º true
console.log(baseObj === doNothingObj)
// ã€æºå¯¹è±¡ã€‘ å’Œ ã€å€ŸåŠ© produce å¯¹æºå¯¹è±¡æ‰§è¡Œè¿‡å†™æ“ä½œåçš„å¯¹è±¡ã€‘ è¿˜æ˜¯åŒä¸€ä¸ªå¯¹è±¡å—ï¼Ÿ
// ç­”æ¡ˆä¸º false
console.log(baseObj === changedObjA)
// æºå¯¹è±¡é‡Œæ²¡æœ‰è¢«æ‰§è¡Œå†™æ“ä½œçš„ b å±æ€§ï¼Œåœ¨ produce æ‰§è¡Œå‰åæ˜¯å¦ä¼šå‘ç”Ÿå˜åŒ–ï¼Ÿ
// è¾“å‡ºä¸º trueï¼Œè¯´æ˜ä¸ä¼šå‘ç”Ÿå˜åŒ–
console.log(baseObj.b === changedObjA.b)
```

:::tip Produce
`Produce` å·¥ä½œåŸç†ï¼šå°†æ‹·è´æ“ä½œç²¾å‡†åŒ–ï¼Œåªè¦å†™æ“ä½œæ²¡æ‰§è¡Œï¼Œæ‹·è´åŠ¨ä½œå°±ä¸ä¼šå‘ç”Ÿï¼Œé€å±‚æ‹·è´ã€‚

`produce` å€ŸåŠ© `Proxy`ï¼Œå°†æ‹·è´åŠ¨ä½œå‘ç”Ÿçš„æ—¶æœºå’Œ `setter` å‡½æ•°çš„è§¦å‘æ—¶æœºç‰¢ç‰¢ç»‘å®šï¼Œç¡®ä¿äº†æ‹·è´åŠ¨ä½œçš„ç²¾ç¡®æ€§ã€‚ è€Œé€å±‚çš„æµ…æ‹·è´ï¼Œåˆ™é—´æ¥åœ°å®ç°äº†æ•°æ®åœ¨æ–°è€å¯¹è±¡é—´çš„å…±äº«ã€‚

åœ¨ `Immer.js` ä¸­ï¼Œå®Œæ•´ç‰ˆ `produce` çš„æµ…æ‹·è´å…¶å®æ˜¯å¯é€’å½’çš„ã€‚
:::

## é«˜é˜¶å‡½æ•° `HOF`

é«˜é˜¶å‡½æ•°ï¼ŒæŒ‡çš„å°±æ˜¯æ¥æ”¶å‡½æ•°ä½œä¸ºå…¥å‚ï¼ˆå›è°ƒï¼‰ï¼Œæˆ–è€…å°†å‡½æ•°ä½œä¸ºå‡ºå‚è¿”å›çš„å‡½æ•°ï¼ˆé—­åŒ…ï¼‰ã€‚

```js
// è£…é¥°å™¨æ¨¡å¼  ï¼ˆå¯¹åŸæœ¬çš„åŠŸèƒ½è¿›è¡ŒåŒ…è£…ï¼‰  åˆ‡ç‰‡ç¼–ç¨‹
function core(a, b, c) {
  console.log('coreã€‚ã€‚ã€‚ã€‚', a, b, c)
}

// æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªåŸå‹ï¼Œ æ‰€æœ‰å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå±æ€§__proto__
Function.prototype.before = function (beforeFn) {
  // this = core // thisçš„æŒ‡å‘ å°±æ˜¯çœ‹è°ƒç”¨è€…
  // è¿™é‡Œreturnçš„å°±æ˜¯newFnå‡½æ•°
  return (...args) => {
    // ç®­å¤´å‡½æ•°ä¸­æ²¡æœ‰this æ²¡æœ‰arguments æ²¡æœ‰prototype
    beforeFn() // å…ˆè°ƒç”¨() => {console.log('core before')} ä»è€Œä¸ä¼šå½±å“coreçš„é€»è¾‘
    this(...args) // ç”¨ç®­å¤´å‡½æ•°æ˜¯ä¸ºäº†è®©ï¼Œè¿™é‡ŒthisæŒ‡å‘core
  }
}

let newFn = core.before(() => {
  console.log('core before')
})

newFn(1, 2, 3)
// core before
// coreã€‚ã€‚ã€‚ã€‚ 1 2 3
```

:::tip
é—­åŒ…ï¼šå®šä¹‰å‡½æ•°çš„ä½œç”¨åŸŸ å’Œ è°ƒç”¨çš„ä½œç”¨åŸŸä¸æ˜¯åŒä¸€ä¸ªã€‚

åœ¨ Function.prototype.before é‡Œå®šä¹‰äº†å‡½æ•°ï¼ˆreturn çš„å‡½æ•°ï¼‰ï¼Œä½†æ˜¯åœ¨å¤–é¢è°ƒç”¨ï¼ˆnewFnï¼‰ï¼Œå°±å½¢æˆé—­åŒ…ã€‚
:::

---

**å®ç°å£°æ˜å¼çš„æ•°æ®æµï¼Œé™¤äº†å€ŸåŠ©é“¾å¼è°ƒç”¨ï¼Œè¿˜å¯ä»¥å€ŸåŠ©å‡½æ•°ç»„åˆã€‚**

## é“¾å¼è°ƒç”¨

`map()`ã€`reduce()`ã€`filter()` è¿™äº›æ–¹æ³•ä¹‹é—´ï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿè¿›è¡Œé“¾å¼è°ƒç”¨ï¼Œæ˜¯å› ä¸ºï¼š

- å®ƒä»¬éƒ½æŒ‚è½½åœ¨ `Array` åŸå‹çš„ `Array.prototype` ä¸Šã€‚
- å®ƒä»¬åœ¨è®¡ç®—ç»“æŸåéƒ½ä¼š `return` ä¸€ä¸ªæ–°çš„ `Array`ã€‚
- æ—¢ç„¶ `return` å‡ºæ¥çš„ä¹Ÿæ˜¯ `Array`ï¼Œé‚£ä¹ˆè‡ªç„¶å¯ä»¥ç»§ç»­è®¿é—®åŸå‹ `Array.prototype` ä¸Šçš„æ–¹æ³•ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œé“¾å¼è°ƒç”¨æ˜¯æœ‰å‰æçš„ã€‚

é“¾å¼è°ƒç”¨çš„æœ¬è´¨ ï¼Œæ˜¯é€šè¿‡åœ¨æ–¹æ³•ä¸­è¿”å›å¯¹è±¡å®ä¾‹æœ¬èº«çš„ `this`/ ä¸å®ä¾‹ `this` ç›¸åŒç±»å‹çš„å¯¹è±¡ï¼Œè¾¾åˆ°å¤šæ¬¡è°ƒç”¨å…¶åŸå‹ï¼ˆé“¾ï¼‰ä¸Šæ–¹æ³•çš„ç›®çš„ã€‚

è¦å¯¹å‡½æ•°æ‰§è¡Œé“¾å¼è°ƒç”¨ï¼Œå‰ææ˜¯å‡½æ•°æŒ‚è½½åœ¨ä¸€ä¸ªé è°±çš„å®¿ä¸» `Object` ä¸Šã€‚

## å‡½æ•°ç»„åˆ

![reduce](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/reduce.png)

### `pipe`

```js
function pipe(funcs) {
  function callback(input, func) {
    return func(input)
  }

  return function (param) {
    return funcs.reduce(callback, param)
  }
}
```

ç®€åŒ–å ğŸ‘‡

```js
function pipe(...fns) {
  return function (param) {
    return fns.reduce((acc, cur) => cur(acc), param)
  }
}
```

### `compose`

```js
function compose(...funcs) {
  function callback(input, func) {
    return func(input)
  }

  return function (param) {
    return funcs.reduceRight(callback, param)
  }
}
```

## å‡½æ•°æŸ¯é‡ŒåŒ–

æŸ¯é‡ŒåŒ–å‡½æ•°åœ¨åå‡½æ•°çš„åŸºç¡€ä¸Šï¼Œä¸ä»…å‡å°‘äº†å‡½æ•°å…¥å‚ä¸ªæ•°ï¼Œè¿˜æ”¹å˜äº†å‡½æ•°æ‰§è¡Œæ¬¡æ•°ã€‚å…¶å«ä¹‰å°±æ˜¯å°†ä¸€ä¸ªæ¥æ”¶ `N` ä¸ªå…¥å‚çš„å‡½æ•°ï¼Œæ”¹å†™ä¸ºæ¥å—ä¸€ä¸ªå…¥å‚ï¼Œå¹¶è¿”å›æ¥å—å‰©ä½™ `N-1`ä¸ªå‚æ•°çš„å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯ï¼š

```js
fn(1,2,3) => fn(1)(2)(3)
```

å®ç°ä¸€ä¸ªæŸ¯é‡ŒåŒ–å‡½æ•°ä¹Ÿæ˜¯é¢è¯•é«˜é¢‘å†…å®¹ï¼Œå…¶å®å¦‚æœè§„å®šäº†å‡½æ•°å…¥å‚ä¸ªæ•°ï¼Œé‚£ä¹ˆæ˜¯å¾ˆå®¹æ˜“å®ç°çš„ã€‚ä¾‹å¦‚å¯¹äºå…¥å‚ä¸ªæ•°ä¸º 3 çš„å‡½æ•°ï¼Œå®ç°å¦‚ä¸‹ï¼š

```js
const curry = (fn) => (arg1) => (arg2) => (arg3) => fn(arg1, arg2, arg3)

const fn = (a, b, c) => console.log(a, b, c)

curry(fn)(1)(2)(3) // 1 2 3
```

é‚£ä¹ˆå®ç°é€šç”¨çš„ `curry` å‡½æ•°çš„å…³é”®å°±åœ¨äºï¼š

- è‡ªåŠ¨åˆ¤æ–­å‡½æ•°å…¥å‚
- è‡ªæˆ‘é€’å½’è°ƒç”¨

```js
const curry = (fn) => {
  const argLen = fn.length // åŸå‡½æ•°çš„å…¥å‚ä¸ªæ•°
  const recursion = (args) =>
    args.length >= argLen ? fn(...args) : (newArg) => recursion([...args, newArg])
  return recursion([])
}
```

## åå‡½æ•°

åå‡½æ•°çš„å®šä¹‰ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå°†å‡½æ•°è½¬æ¢ä¸ºå‚æ•°æ›´å°‘çš„å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸ºå…¶é¢„è®¾å‚æ•°ã€‚

```sh
ä» fn(arg1, arg2) åˆ° fn(arg1)
```

```js
function multiply(x, y) {
  return x * y
}

// å®šä¹‰ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œä¸“é—¨ç”¨æ¥å¤„ç†åå‡½æ•°é€»è¾‘
function wrapFunc(func, fixedValue) {
  // åŒ…è£…å‡½æ•°çš„ç›®æ ‡è¾“å‡ºæ˜¯ä¸€ä¸ªæ–°çš„å‡½æ•°
  function wrappedFunc(input) {
    // è¿™ä¸ªå‡½æ•°ä¼šå›ºå®š fixedValueï¼Œç„¶åæŠŠ input ä½œä¸ºåŠ¨æ€å‚æ•°è¯»å–
    const newFunc = func(input, fixedValue)
    return newFunc
  }
  return wrappedFunc
}
const multiply3 = wrapFunc(multiply, 3)

// è¾“å‡º6
multiply3(2)
```
