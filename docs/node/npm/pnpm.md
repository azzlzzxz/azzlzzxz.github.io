# PNPM

## `pnpm` ä»‹ç»

`pnpm - performant npm`ï¼Œåœ¨ `2017` å¹´æ­£å¼å‘å¸ƒï¼Œå®šä¹‰ä¸ºå¿«é€Ÿçš„ï¼ŒèŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å·¥å…·ï¼Œå¼€åˆ›äº†ä¸€å¥—æ–°çš„ä¾èµ–ç®¡ç†æœºåˆ¶ï¼Œæˆä¸ºäº†åŒ…ç®¡ç†çš„åèµ·ä¹‹ç§€ã€‚

## èŠ‚çœç£ç›˜ç©ºé—´

ä½¿ç”¨ `npm` æ—¶ï¼Œä¾èµ–æ¯æ¬¡è¢«ä¸åŒçš„é¡¹ç›®ä½¿ç”¨ï¼Œéƒ½ä¼šé‡å¤å®‰è£…ä¸€æ¬¡ã€‚ è€Œåœ¨ä½¿ç”¨ `pnpm` æ—¶ï¼Œä¾èµ–ä¼šè¢«å­˜å‚¨åœ¨å†…å®¹å¯å¯»å€çš„å­˜å‚¨ä¸­ï¼Œæ‰€ä»¥ï¼š

- å¦‚æœä½ ç”¨åˆ°äº†æŸä¾èµ–é¡¹çš„ä¸åŒç‰ˆæœ¬ï¼Œåªä¼šå°†ä¸åŒç‰ˆæœ¬é—´æœ‰å·®å¼‚çš„æ–‡ä»¶æ·»åŠ åˆ°ä»“åº“ã€‚

> ä¸¾ä¸ª ğŸŒ°

å¦‚æœæŸä¸ªåŒ…æœ‰ `100` ä¸ªæ–‡ä»¶ï¼Œè€Œå®ƒçš„æ–°ç‰ˆæœ¬åªæ”¹å˜äº†å…¶ä¸­ `1` ä¸ªæ–‡ä»¶ã€‚é‚£ä¹ˆ `pnpm update` æ—¶åªä¼šå‘å­˜å‚¨ä¸­å¿ƒé¢å¤–æ·»åŠ  `1` ä¸ªæ–°æ–‡ä»¶ï¼Œè€Œä¸ä¼šå› ä¸ºä»…ä»…ä¸€ä¸ªæ–‡ä»¶çš„æ”¹å˜å¤åˆ¶æ•´æ–°ç‰ˆæœ¬åŒ…çš„å†…å®¹ã€‚

- æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šå­˜å‚¨åœ¨ç¡¬ç›˜ä¸Šçš„æŸä¸€ä½ç½®ã€‚ å½“è½¯ä»¶åŒ…è¢«è¢«å®‰è£…æ—¶ï¼ŒåŒ…é‡Œçš„æ–‡ä»¶ä¼šç¡¬é“¾æ¥åˆ°è¿™ä¸€ä½ç½®ï¼Œè€Œä¸ä¼šå ç”¨é¢å¤–çš„ç£ç›˜ç©ºé—´ã€‚

è¿™å…è®¸ä½ è·¨é¡¹ç›®åœ°å…±äº«åŒä¸€ç‰ˆæœ¬çš„ä¾èµ–ï¼Œå› æ­¤ï¼Œæ‚¨åœ¨ç£ç›˜ä¸ŠèŠ‚çœäº†å¤§é‡ç©ºé—´ï¼Œè¿™ä¸é¡¹ç›®å’Œä¾èµ–é¡¹çš„æ•°é‡æˆæ­£æ¯”ï¼Œå¹¶ä¸”å®‰è£…é€Ÿåº¦è¦å¿«å¾—å¤šï¼

![pnpm_one](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/pnpm_one.jpg)

### ç¡¬é“¾æ¥

1. ç¡¬é“¾æ¥å°±æ˜¯å¤šä¸ªæ–‡ä»¶åæŒ‡å‘äº†åŒä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¤šä¸ªæ–‡ä»¶äº’ä¸ºç¡¬é“¾æ¥ã€‚

2. é€šè¿‡ç¡¬é“¾æ¥ï¼Œä¸ä¼šäº§ç”Ÿé¢å¤–çš„ç£ç›˜å ç”¨ï¼Œå¹¶ä¸”ï¼Œä¸¤ä¸ªæ–‡ä»¶éƒ½èƒ½æ‰¾åˆ°ç›¸åŒçš„ç£ç›˜å†…å®¹
3. ç¡¬é“¾æ¥çš„æ•°é‡æ²¡æœ‰é™åˆ¶ï¼Œå¯ä»¥ä¸ºåŒä¸€ä¸ªæ–‡ä»¶äº§ç”Ÿå¤šä¸ªç¡¬é“¾æ¥
4. ç¡¬é“¾æ¥çš„æ¦‚å¿µæ¥è‡ªäº `Unix` æ“ä½œç³»ç»Ÿï¼Œå®ƒæ˜¯æŒ‡å°†ä¸€ä¸ªæ–‡ä»¶ `A` æŒ‡é’ˆå¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ `B` æŒ‡é’ˆä¸­ï¼Œæ–‡ä»¶ `B` å°±æ˜¯æ–‡ä»¶ `A` çš„ç¡¬é“¾æ¥

![hard_link](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/hard_link.jpg)

### è½¯è¿æ¥(ç¬¦å·é“¾æ¥)

1. è½¯é“¾æ¥å°±æ˜¯å¿«æ·æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ã€‚å°±åƒæˆ‘ä»¬ç”µè„‘æ¡Œé¢ä¸Šçš„å¿«æ·æ–¹å¼ï¼Œå¤§å°åªæœ‰å‡ å­—èŠ‚ï¼ŒæŒ‡å‘æºæ–‡ä»¶ï¼Œç‚¹å‡»å¿«æ·æ–¹å¼ï¼Œå…¶å®æ‰§è¡Œçš„å°±æ˜¯æºæ–‡ä»¶ã€‚

2. ç¬¦å·é“¾æ¥åˆç§°ä¸ºè½¯è¿æ¥ï¼Œå¦‚æœä¸ºæŸä¸ªæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ `A` åˆ›å»ºç¬¦å·è¿æ¥ `B`ï¼Œåˆ™ `B` æŒ‡å‘ `A`ã€‚

![symbol_link](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/symbol_link.jpg)

### è½¯é“¾æ¥å’Œç¡¬é“¾æ¥çš„åŒºåˆ«

1. ç¡¬é“¾æ¥ä»…èƒ½é“¾æ¥æ–‡ä»¶ï¼Œè€Œç¬¦å·é“¾æ¥å¯ä»¥é“¾æ¥ç›®å½•

2. ç¡¬é“¾æ¥åœ¨é“¾æ¥å®Œæˆåä»…å’Œæ–‡ä»¶å†…å®¹å…³è”ï¼Œå’Œä¹‹å‰é“¾æ¥çš„æ–‡ä»¶æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚è€Œç¬¦å·é“¾æ¥å§‹ç»ˆå’Œä¹‹å‰é“¾æ¥çš„æ–‡ä»¶å…³è”ï¼Œå’Œæ–‡ä»¶å†…å®¹ä¸ç›´æ¥ç›¸å…³

### `node` ç¯å¢ƒå¯¹ç¡¬é“¾æ¥å’Œè½¯é“¾æ¥çš„å¤„ç†

1. ç¡¬é“¾æ¥ï¼šç¡¬é“¾æ¥æ˜¯ä¸€ä¸ªå®å®åœ¨åœ¨çš„æ–‡ä»¶ï¼Œ`node` ä¸å¯¹å…¶åšä»»ä½•ç‰¹æ®Šå¤„ç†ï¼Œä¹Ÿæ— æ³•åŒºåˆ«å¯¹å¾…ï¼Œå®é™…ä¸Šï¼Œ`node` æ ¹æœ¬æ— ä»çŸ¥æ™“è¯¥æ–‡ä»¶æ˜¯ä¸æ˜¯ä¸€ä¸ªç¡¬é“¾æ¥

2. è½¯é“¾æ¥ï¼šç”±äºç¬¦å·é“¾æ¥æŒ‡å‘çš„æ˜¯å¦ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œå½“ `node` æ‰§è¡Œç¬¦å·é“¾æ¥ä¸‹çš„ `JS` æ–‡ä»¶æ—¶ï¼Œä¼šä½¿ç”¨åŸå§‹è·¯å¾„ã€‚

## `pnpm` åŸç†

`pnpm` å¼•å…¥äº†å¦ä¸€å¥—ä¾èµ–ç®¡ç†ç­–ç•¥ï¼šå†…å®¹å¯»å€å­˜å‚¨ã€‚

è¯¥ç­–ç•¥ä¼šå°†åŒ…å®‰è£…åœ¨ç³»ç»Ÿçš„å…¨å±€ `store` ä¸­ï¼Œä¾èµ–çš„æ¯ä¸ªç‰ˆæœ¬åªä¼šåœ¨ç³»ç»Ÿä¸­å®‰è£…ä¸€æ¬¡ã€‚

![pnpm_store](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/pnpm_store.jpg)

åœ¨å¼•ç”¨é¡¹ç›® `node_modules` çš„ä¾èµ–æ—¶ï¼Œä¼šé€šè¿‡ç¡¬é“¾æ¥ä¸ç¬¦å·é“¾æ¥åœ¨å…¨å±€ `store` ä¸­æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚

`node_modules` ä¸­æ¯ä¸ªåŒ…çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯æ¥è‡ªå†…å®¹å¯å¯»å€å­˜å‚¨çš„ç¡¬é“¾æ¥ã€‚

å‡è®¾æ‚¨å®‰è£…äº†ä¾èµ–äº `bar@1.0.0` çš„ `foo@1.0.0`ã€‚ `pnpm` ä¼šå°†ä¸¤ä¸ªåŒ…ç¡¬é“¾æ¥åˆ° `node_modules` å¦‚ä¸‹æ‰€ç¤ºï¼š

```lua
node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ bar@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â””â”€â”€ bar -> <store>/bar
    â”‚           â”œâ”€â”€ index.js
    â”‚           â””â”€â”€ package.json
    â””â”€â”€ foo@1.0.0
        â””â”€â”€ node_modules
            â””â”€â”€ foo -> <store>/foo
                â”œâ”€â”€ index.js
                â””â”€â”€ package.json
```

![pnpm_pj](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/pnpm_pj.jpg)

è¿™æ˜¯`node_modules` ä¸­çš„å”¯ä¸€çš„`â€œçœŸå®â€`æ–‡ä»¶ã€‚ ä¸€æ—¦æ‰€æœ‰åŒ…éƒ½ç¡¬é“¾æ¥åˆ°`node_modules`ï¼Œå°±ä¼šåˆ›å»ºç¬¦å·é“¾æ¥æ¥æ„å»ºåµŒå¥—çš„ä¾èµ–å…³ç³»å›¾ç»“æ„ã€‚

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œè¿™ä¸¤ä¸ªåŒ…éƒ½ç¡¬é“¾æ¥åˆ°ä¸€ä¸ª`node_modules` æ–‡ä»¶å¤¹ï¼ˆ`foo@1.0.0/node_modules/foo`ï¼‰å†…çš„å­æ–‡ä»¶å¤¹ä¸­ã€‚

::: tip

- å…è®¸åŒ…è‡ªè¡Œå¯¼å…¥è‡ªå·±ã€‚

`foo` åº”è¯¥èƒ½å¤Ÿ `require('foo/package.json')` æˆ–è€… `import \* as package from "foo/package.json"ã€‚`

- é¿å…å¾ªç¯ç¬¦å·é“¾æ¥ã€‚

ä¾èµ–ä»¥åŠéœ€è¦ä¾èµ–çš„åŒ…è¢«æ”¾ç½®åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ å¯¹äº `Node.js` æ¥è¯´ï¼Œä¾èµ–æ˜¯åœ¨åŒ…çš„å†…éƒ¨`node_modules` ä¸­æˆ–åœ¨ä»»ä½•å…¶å®ƒåœ¨çˆ¶ç›®å½•`node_modules` ä¸­æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚

:::

å®‰è£…çš„ä¸‹ä¸€é˜¶æ®µæ˜¯ç¬¦å·é“¾æ¥ä¾èµ–é¡¹ã€‚ `bar` å°†è¢«ç¬¦å·é“¾æ¥åˆ° `foo@1.0.0/node_modules` æ–‡ä»¶å¤¹ï¼š

```lua
node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ bar@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â””â”€â”€ bar -> <store>/bar
    â””â”€â”€ foo@1.0.0
        â””â”€â”€ node_modules
            â”œâ”€â”€ foo -> <store>/foo
            â””â”€â”€ bar -> ../../bar@1.0.0/node_modules/bar
```

![pnpm_form-data](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/pnpm_form-data.jpg)

æ¥ä¸‹æ¥ï¼Œå¤„ç†ç›´æ¥ä¾èµ–å…³ç³»ã€‚ `foo` å°†è¢«ç¬¦å·é“¾æ¥è‡³æ ¹ç›®å½•çš„`node_modules` æ–‡ä»¶å¤¹ï¼Œå› ä¸º `foo` æ˜¯é¡¹ç›®çš„ä¾èµ–é¡¹ï¼š

```lua
node_modules
â”œâ”€â”€ foo -> ./.pnpm/foo@1.0.0/node_modules/foo
â””â”€â”€ .pnpm
    â”œâ”€â”€ bar@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â””â”€â”€ bar -> <store>/bar
    â””â”€â”€ foo@1.0.0
        â””â”€â”€ node_modules
            â”œâ”€â”€ foo -> <store>/foo
            â””â”€â”€ bar -> ../../bar@1.0.0/node_modules/bar
```

![pnpm_axios](https://steinsgate.oss-cn-hangzhou.aliyuncs.com/pnpm_axios.jpg)

è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚ ä½†æ˜¯ï¼Œæ— è®ºä¾èµ–é¡¹çš„æ•°é‡å’Œä¾èµ–å…³ç³»å›¾çš„æ·±åº¦å¦‚ä½•ï¼Œå¸ƒå±€éƒ½ä¼šä¿æŒè¿™ç§ç»“æ„ã€‚

è®©æˆ‘ä»¬æ·»åŠ  `qar@2.0.0` ä½œä¸º `bar` å’Œ `foo` çš„ä¾èµ–é¡¹ã€‚ è¿™æ˜¯æ–°çš„ç»“æ„çš„æ ·å­ï¼š

```lua
node_modules
â”œâ”€â”€ foo -> ./.pnpm/foo@1.0.0/node_modules/foo
â””â”€â”€ .pnpm
    â”œâ”€â”€ bar@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ bar -> <store>/bar
    â”‚       â””â”€â”€ qar -> ../../qar@2.0.0/node_modules/qar
    â”œâ”€â”€ foo@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo -> <store>/foo
    â”‚       â”œâ”€â”€ bar -> ../../bar@1.0.0/node_modules/bar
    â”‚       â””â”€â”€ qar -> ../../qar@2.0.0/node_modules/qar
    â””â”€â”€ qar@2.0.0
        â””â”€â”€ node_modules
            â””â”€â”€ qar -> <store>/qar
```

å¦‚ä½ æ‰€è§ï¼Œå³ä½¿å›¾å½¢ç°åœ¨æ›´æ·±`ï¼ˆfoo > bar > qarï¼‰`ï¼Œä½†ç›®å½•æ·±åº¦ä»ç„¶ç›¸åŒã€‚

è¿™ç§å¸ƒå±€ä¹ä¸€çœ‹å¯èƒ½å¾ˆå¥‡æ€ªï¼Œä½†å®ƒä¸ `Node` çš„æ¨¡å—è§£æç®—æ³•å®Œå…¨å…¼å®¹ï¼

è§£ææ¨¡å—æ—¶ï¼Œ`Node` ä¼šå¿½ç•¥ç¬¦å·é“¾æ¥ï¼Œå› æ­¤å½“ `foo@1.0.0/node_modules/foo/index.js` éœ€è¦ `bar` æ—¶ï¼Œ`Node` ä¸ä¼šä½¿ç”¨åœ¨ `foo@1.0.0/node_modules/bar` çš„ `bar`ï¼Œç›¸å`bar` æ˜¯è¢«è§£æåˆ°å…¶å®é™…ä½ç½®`ï¼ˆbar@1.0.0/node_modules/barï¼‰`ã€‚

å› æ­¤ï¼Œ`bar` ä¹Ÿå¯ä»¥è§£æå…¶åœ¨ `bar@1.0.0/node_modules` ä¸­çš„ä¾èµ–é¡¹ã€‚

è¿™ç§å¸ƒå±€çš„ä¸€å¤§å¥½å¤„æ˜¯åªæœ‰çœŸæ­£åœ¨ä¾èµ–é¡¹ä¸­çš„åŒ…æ‰èƒ½è®¿é—®ã€‚

## å¤„ç† `peerDependencies`

`pnpm` çš„æœ€ä½³ç‰¹å¾ä¹‹ä¸€æ˜¯ï¼Œåœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œ`package` çš„ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬å°†å§‹ç»ˆåªæœ‰ä¸€ç»„ä¾èµ–é¡¹ã€‚

::: tip è¿™ä¸ªè§„åˆ™æœ‰ä¸€ä¸ªä¾‹å¤–

- é‚£å°±æ˜¯å…·æœ‰ `peer dependencies` çš„ `package`

:::

`peer` ä¾èµ–é¡¹`ï¼ˆpeer dependenciesï¼‰`ä¼šä»ä¾èµ–å›¾ä¸­æ›´é«˜çš„å·²å®‰è£…çš„ä¾èµ–é¡¹ä¸­è§£æ`ï¼ˆresolveï¼‰`ï¼Œå› ä¸ºå®ƒä»¬ä¸çˆ¶çº§å…±äº«ç›¸åŒçš„ç‰ˆæœ¬ã€‚

è¿™æ„å‘³ç€ï¼Œå¦‚æœ `foo@1.0.0` æœ‰ä¸¤ä¸ª `peers` ä¾èµ–`ï¼ˆbar@^1 å’Œ baz@^1ï¼‰`ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰å¤šä¸ªä¸åŒçš„ä¾èµ–é¡¹é›†åˆã€‚

```lua
- foo-parent-1
  - bar@1.0.0
  - baz@1.0.0
  - foo@1.0.0
- foo-parent-2
  - bar@1.0.0
  - baz@1.1.0
  - foo@1.0.0
```

åœ¨ ğŸ‘† çš„ç¤ºä¾‹ä¸­ï¼Œ `foo@1.0.0` å·²å®‰è£…åœ¨ `foo-parent-1` å’Œ `foo-parent-2` ä¸­ã€‚

è¿™ä¸¤ä¸ªåŒ…éƒ½æœ‰ä¾èµ–åŒ… `baz` å’Œ `bar`, ä½†æ˜¯å®ƒä»¬å´ä¾èµ–ç€ä¸åŒç‰ˆæœ¬çš„ `baz`ã€‚

å› æ­¤ï¼Œ`foo@1.0.0` æœ‰ä¸¤ç»„ä¸åŒçš„ä¾èµ–é¡¹ï¼šä¸€ç»„å…·æœ‰ `baz@1.0.0` ï¼Œå¦ä¸€ç»„å…·æœ‰ `baz@1.1.0`ã€‚ è‹¥è¦æ”¯æŒè¿™äº›ç”¨ä¾‹ï¼Œ`pnpm` å¿…é¡»æœ‰å‡ ç»„ä¸åŒçš„ä¾èµ–é¡¹ï¼Œå°±å»ç¡¬é“¾æ¥å‡ æ¬¡ `foo@1.0.0`ã€‚

é€šå¸¸ï¼Œå¦‚æœä¸€ä¸ª `package` æ²¡æœ‰ `peer` ä¾èµ–é¡¹`ï¼ˆpeer dependenciesï¼‰`ï¼Œå®ƒä¼šè¢«ç¡¬é“¾æ¥åˆ°å…¶ä¾èµ–é¡¹çš„`è½¯è¿æ¥ï¼ˆsymlinksï¼‰`æ—çš„ `node_modules`ï¼Œå°±åƒè¿™æ ·ï¼š

```lua
node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ foo@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ qux   -> ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -> ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ qux@1.0.0
    â”œâ”€â”€ plugh@1.0.0
```

ä½†æ˜¯ï¼Œå¦‚æœ `foo` æœ‰ `peer` ä¾èµ–`ï¼ˆpeer dependenciesï¼‰`ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½å°±ä¼šæœ‰å¤šç»„ä¾èµ–é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºä¸åŒçš„ `peer` ä¾èµ–é¡¹åˆ›å»ºä¸åŒçš„è§£æï¼š

```lua
node_modules
â””â”€â”€ .pnpm
    â”œâ”€â”€ foo@1.0.0_bar@1.0.0+baz@1.0.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ bar   -> ../../bar@1.0.0/node_modules/bar
    â”‚       â”œâ”€â”€ baz   -> ../../baz@1.0.0/node_modules/baz
    â”‚       â”œâ”€â”€ qux   -> ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -> ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ foo@1.0.0_bar@1.0.0+baz@1.1.0
    â”‚   â””â”€â”€ node_modules
    â”‚       â”œâ”€â”€ foo
    â”‚       â”œâ”€â”€ bar   -> ../../bar@1.0.0/node_modules/bar
    â”‚       â”œâ”€â”€ baz   -> ../../baz@1.1.0/node_modules/baz
    â”‚       â”œâ”€â”€ qux   -> ../../qux@1.0.0/node_modules/qux
    â”‚       â””â”€â”€ plugh -> ../../plugh@1.0.0/node_modules/plugh
    â”œâ”€â”€ bar@1.0.0
    â”œâ”€â”€ baz@1.0.0
    â”œâ”€â”€ baz@1.1.0
    â”œâ”€â”€ qux@1.0.0
    â”œâ”€â”€ plugh@1.0.0
```

æˆ‘ä»¬åˆ›å»º `foo@1.0.0_bar@1.0.0+baz@1.0.0`æˆ–`foo@1.0.0_bar@1.0.0+baz@1.1.0`å†…åˆ° `foo` çš„è½¯é“¾æ¥ã€‚ å› æ­¤ï¼Œ`Node.js` æ¨¡å—è§£æå™¨å°†æ‰¾åˆ°æ­£ç¡®çš„ `peers`ã€‚

å¦‚æœä¸€ä¸ª `package` æ²¡æœ‰ `peer` ä¾èµ–ï¼ˆ`peer dependenciesï¼‰`ï¼Œä¸è¿‡å®ƒçš„ä¾èµ–é¡¹æœ‰ `peer` ä¾èµ–ï¼Œè¿™äº›ä¾èµ–ä¼šåœ¨æ›´é«˜çš„ä¾èµ–å›¾ä¸­è§£æ, åˆ™è¿™ä¸ªä¼ é€’ `package` ä¾¿å¯åœ¨é¡¹ç›®ä¸­æœ‰å‡ ç»„ä¸åŒçš„ä¾èµ–é¡¹ã€‚

## `.npmrc`

`pnpm`çš„é…ç½®æ–‡ä»¶

### ä¾èµ–æå‡è®¾ç½®

ä¾èµ–é¡¹éƒ½ä¼šè¢«æå‡åˆ° `node_modules/.pnpm/node_modules`

#### `hoist`

å½“ `hoist` ä¸º `true` æ—¶ï¼Œæ‰€æœ‰ä¾èµ–é¡¹éƒ½ä¼šè¢«æå‡åˆ° `node_modules/.pnpm/node_modules`ã€‚ è¿™ä½¿å¾— `node_modules` æ‰€æœ‰åŒ…éƒ½å¯ä»¥è®¿é—® æœªåˆ—å‡ºçš„ä¾èµ–é¡¹ã€‚

```sh
hoist = true
```

#### `hoist-pattern`

å‘Šè¯‰ `pnpm` å“ªäº›åŒ…åº”è¯¥è¢«æå‡åˆ° `node_modules/.pnpm/node_modules`ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰åŒ…éƒ½è¢«æå‡ â€”â€” ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çŸ¥é“åªæœ‰æŸäº›æœ‰ç¼ºé™·çš„åŒ…å…·æœ‰å¹»å½±ä¾èµ–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹ä¸“é—¨æå‡å¹»å½±ä¾èµ–ï¼ˆæ¨èåšæ³•ï¼‰ã€‚

```sh
hoist-pattern[] = [*]
hoist-pattern[] = *eslint*
hoist-pattern[] = *babel*
```

#### `public-hoist-pattern`

ä¸åŒäº `hoist-pattern` ä¼šæŠŠä¾èµ–æå‡åˆ°ä¸€ä¸ªè™šæ‹Ÿå­˜å‚¨ä¸­çš„éšè—çš„æ¨¡å—ç›®å½•ä¸­ï¼Œ`public-hoist-pattern` å°†åŒ¹é…çš„ä¾èµ–æå‡è‡³æ ¹æ¨¡å—ç›®å½•ä¸­ã€‚ æå‡è‡³æ ¹æ¨¡å—ç›®å½•ä¸­æ„å‘³ç€åº”ç”¨ä»£ç å¯ä»¥è®¿é—®åˆ°å¹»å½±ä¾èµ–ï¼Œå³ä½¿ä»–ä»¬å¯¹è§£æç­–ç•¥åšäº†ä¸å½“çš„ä¿®æ”¹ã€‚

```sh
public-hoist-pattern[] = ['*eslint*', '*prettier*']
```

#### `shamefully-hoist`

```sh
shamefully-hoist = true

# =

public-hoist-pattern[] = *
```

### `Peer Dependency` è®¾ç½®

é’ˆå¯¹ `Peer Dependency` å¤„ç†çš„è®¾ç½®

#### `auto-install-peers`

å½“å€¼ä¸º `true` æ—¶ï¼Œå°†è‡ªåŠ¨å®‰è£…ä»»ä½•ç¼ºå°‘çš„éå¯é€‰åŒçº§ä¾èµ–å…³ç³»ã€‚

```sh
auto-install-peers = true
```

## æ”¯æŒ PnP

```sh
node-linker=pnp
symlink=false
```

::: info ç›¸å…³èµ„æ–™

- [<u>pnpm å®˜ç½‘</u>](https://pnpm.io/zh/)

:::
