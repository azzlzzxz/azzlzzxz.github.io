import{_ as a,o as n,c as l,N as o}from"./chunks/framework.2f525601.js";const F=JSON.parse('{"title":"æµè§ˆå™¨ç›¸å…³çš„ API","description":"","frontmatter":{},"headers":[],"relativePath":"base/browser/api.md","lastUpdated":1729591560000}'),p={name:"base/browser/api.md"};function e(c,s,t,r,i,y){return n(),l("div",null,s[0]||(s[0]=[o(`<h1 id="æµè§ˆå™¨ç›¸å…³çš„-api" tabindex="-1">æµè§ˆå™¨ç›¸å…³çš„ API <a class="header-anchor" href="#æµè§ˆå™¨ç›¸å…³çš„-api" aria-label="Permalink to &quot;æµè§ˆå™¨ç›¸å…³çš„ API&quot;">â€‹</a></h1><h2 id="history-api" tabindex="-1">History API <a class="header-anchor" href="#history-api" aria-label="Permalink to &quot;History API&quot;">â€‹</a></h2><p><code>History API</code> é€šè¿‡ <code>history</code> å…¨å±€å¯¹è±¡æä¾›äº†å¯¹æµè§ˆå™¨ä¼šè¯çš„å†å²è®°å½•ï¼Œä½ å¯ä»¥åœ¨ç”¨æˆ·çš„å†å²è®°å½•ä¸­æ¥å›å¯¼èˆªï¼Œè€Œä¸”å¯ä»¥æ“ä½œå†å²è®°å½•æ ˆä¸­çš„å†…å®¹ã€‚</p><div class="tip custom-block"><p class="custom-block-title">æ³¨æ„ âš ï¸</p><p><code>History API</code> ä»…åœ¨ä¸»çº¿ç¨‹<code>ï¼ˆWindowï¼‰</code>ä¸­å¯ç”¨ã€‚æ— æ³•åœ¨ <code>Worker</code> ä¸Šä¸‹æ–‡ä¸­è®¿é—®å®ƒã€‚</p></div><ul><li><code>history.back()</code></li></ul><p>åœ¨å†å²è®°å½•ä¸­å‘åè·³è½¬ï¼Œè¿™å’Œç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„å›é€€<code>ï¼ˆBackï¼‰</code>æŒ‰é’®çš„æ•ˆæœç›¸åŒã€‚</p><ul><li><code>history.forward()</code></li></ul><p>åœ¨å†å²è®°å½•ä¸­å‘å‰è·³è½¬ï¼Œè¿™å’Œç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„å›é€€<code>ï¼ˆForwardï¼‰</code>æŒ‰é’®çš„æ•ˆæœç›¸åŒã€‚</p><ul><li><code>history.go()</code></li></ul><p>å¯ä»¥ç”¨ <code>go()</code>æ–¹æ³•ä»ä¼šè¯å†å²è®°å½•ä¸­åŠ è½½æŸä¸€ç‰¹å®šé¡µé¢ï¼Œè¯¥é¡µé¢ä½¿ç”¨ä¸å½“å‰é¡µé¢çš„ç›¸å¯¹ä½ç½®æ¥æ ‡è¯†ï¼ˆå½“å‰é¡µé¢çš„ç›¸å¯¹ä½ç½®ä¸º 0ï¼‰ã€‚</p><blockquote><p>ä¸¾ä¸ª ğŸŒ°</p></blockquote><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">go</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">go</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä»¥ä¸‹è¯­å¥éƒ½å…·æœ‰åˆ·æ–°é¡µé¢çš„æ•ˆæœ</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">go</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">go</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>history.length</code></li></ul><p>å¯ä»¥é€šè¿‡æŸ¥çœ‹ <code>length</code> å±æ€§çš„å€¼æ¥ç¡®å®šå†å²è®°å½•æ ˆä¸­çš„é¡µé¢æ•°é‡ã€‚</p><ul><li><code>history.pushState()</code></li></ul><p>å‘æµè§ˆå™¨çš„ä¼šè¯å†å²æ ˆå¢åŠ äº†ä¸€ä¸ªæ¡ç›®ã€‚</p><ul><li><code>history.replaceState()</code></li></ul><p>ç”¨æ–°çš„æ¡ç›®æ›¿æ¢å½“å‰çš„å†å²è®°å½•æ¡ç›®ã€‚</p><ul><li><code>popstate</code></li></ul><p><code>popstate</code> äº‹ä»¶åªä¼šåœ¨æµè§ˆå™¨æŸäº›è¡Œä¸ºä¸‹è§¦å‘ï¼Œæ¯”å¦‚ç‚¹å‡»åé€€æŒ‰é’®ï¼ˆæˆ–è€…åœ¨ <code>JavaScript</code> ä¸­è°ƒç”¨ <code>history.back()</code> æ–¹æ³•ï¼‰ã€‚åœ¨åŒä¸€æ–‡æ¡£çš„ä¸¤ä¸ªå†å²è®°å½•æ¡ç›®ä¹‹é—´å¯¼èˆªä¼šè§¦å‘è¯¥äº‹ä»¶ã€‚</p><blockquote><p>ä¸¾ä¸ª ğŸŒ°</p></blockquote><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">popstate</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">alert</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">ä½ç½®ï¼š</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">document</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">location</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">ï¼ŒçŠ¶æ€ï¼š</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#BABED8;">(event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">state)</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pushState</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">page</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ ‡é¢˜ 1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?page=1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pushState</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">page</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ ‡é¢˜ 2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?page=2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replaceState</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">page</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ ‡é¢˜ 3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">?page=3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">back</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// http://example.com/example.html?page=1ï¼ŒçŠ¶æ€ï¼š{&quot;page&quot;:1}â€</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">back</span><span style="color:#BABED8;">() </span><span style="color:#676E95;font-style:italic;">// http://example.com/example.htmlï¼ŒçŠ¶æ€ï¼šnullâ€</span></span>
<span class="line"><span style="color:#BABED8;">history</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">go</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">// http://example.com/example.html?page=3ï¼ŒçŠ¶æ€ï¼š{&quot;page&quot;:3}â€</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li><code>hashchange</code></li></ul><p>å½“ <code>URL</code> çš„ç‰‡æ®µæ ‡è¯†ç¬¦ï¼ˆä»¥ <code>#</code> ç¬¦å·å¼€å¤´å’Œä¹‹åçš„ <code>URL</code> éƒ¨åˆ†ï¼‰æ›´æ”¹æ—¶ï¼Œå°†è§¦å‘ <code>hashchange</code> äº‹ä»¶ã€‚</p><div class="tip custom-block"><p class="custom-block-title">æ³¨æ„</p><ul><li><code>history.pushState</code>ã€<code>history.replaceState</code> è¿™ç§å¹¶ä¸ä¼šè§¦å‘ <code>popstate</code>ï¼Œåªæœ‰åœ¨ <code>history</code> ä¹‹é—´å¯¼èˆªæ‰ä¼šè§¦å‘ã€‚</li></ul></div><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API" target="_blank" rel="noreferrer"><u>MDN | History_API</u></a></li></ul></div><h2 id="requestidlecallback" tabindex="-1">requestIdleCallback <a class="header-anchor" href="#requestidlecallback" aria-label="Permalink to &quot;requestIdleCallback&quot;">â€‹</a></h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback" target="_blank" rel="noreferrer"><u>MDN requestIdleCallback API ğŸš€</u></a></p><ul><li>æˆ‘ä»¬å¸Œæœ›å¿«é€Ÿå“åº”ç”¨æˆ·ï¼Œè®©ç”¨æˆ·è§‰å¾—å¤Ÿå¿«ï¼Œä¸èƒ½é˜»å¡ç”¨æˆ·çš„äº¤äº’ã€‚</li><li><code>requestIdleCallback</code> ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚</li><li>æ­£å¸¸å¸§ä»»åŠ¡å®Œæˆåæ²¡è¶…è¿‡ <code>16.6 ms</code>ï¼Œè¯´æ˜æ—¶é—´æœ‰å¯Œä½™ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œ <code>requestIdleCallback</code> é‡Œæ³¨å†Œçš„ä»»åŠ¡ã€‚</li></ul><p><img src="https://steinsgate.oss-cn-hangzhou.aliyuncs.com/requestIdleCallback.jpeg" alt="requestIdleCallback"></p><div class="tip custom-block"><p class="custom-block-title">ç¼ºç‚¹</p><ol><li>å…¼å®¹æ€§é—®é¢˜ <a href="https://caniuse.com/?search=requestIdleCallback" target="_blank" rel="noreferrer"><u>requestIdleCallback çš„å…¼å®¹æ€§ ğŸš€</u></a>ã€‚</li><li>æ‰§è¡Œä»»åŠ¡çš„å¸§ç©ºé—²æ—¶é—´ä¸å¯æ§ï¼ˆ<code>React</code> è‡ªå·±å®ç°äº†ä¸€ä¸ª <code>requestIdleCallback</code>ï¼‰ã€‚</li><li>ä¸€ä¸ªä»»åŠ¡å°±æ˜¯æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œä¸èƒ½è¢«æ‰“æ–­ï¼Œæ‰€ä»¥æœ‰å¯èƒ½ä¼šè¢«å¡ä½ã€‚</li></ol></div><blockquote><p>ä¸¾ä¸ªä¾‹å­ ğŸŒ°</p></blockquote><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">http-equiv</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">X-UA-Compatible</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">IE=edge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">requestIdleCallback</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">duration</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Date</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">duration</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> ) </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> works </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> [</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬1ä¸ªä»»åŠ¡å¼€å§‹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// ä»»åŠ¡æ‰§è¡Œæ—¶é—´å°‘è¿‡å½“å‰å¸§çš„ç©ºä½™æ—¶é—´ï¼Œå°±ä¼šç­‰å¾…å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå½“å‰å¸§æ‰ä¼šç»“æŸ</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬1ä¸ªä»»åŠ¡ç»“æŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬2ä¸ªä»»åŠ¡å¼€å§‹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">20</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬2ä¸ªä»»åŠ¡ç»“æŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬3ä¸ªä»»åŠ¡å¼€å§‹</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">sleep</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">20</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬3ä¸ªä»»åŠ¡ç»“æŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">      ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">requestIdleCallback</span><span style="color:#BABED8;">(workLoop)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">workLoop</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">deadline</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å› ä¸ºä¸€å¸§æ˜¯16.6msï¼Œæµè§ˆå™¨æ‰§è¡Œå®Œé«˜ä¼˜å…ˆçº§ä¹‹åï¼Œå¦‚æœè¿˜æœ‰æ—¶é—´ï¼Œä¼šæ‰§è¡ŒworkLoop,timeRemainingè·å–æ­¤å¸§å‰©ä¸‹çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">æœ¬å¸§çš„å‰©ä½™æ—¶é—´æ˜¯</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">deadline</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">timeRemaining</span><span style="color:#F07178;">())</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å¦‚æœæ²¡æœ‰å‰©ä½™æ—¶é—´äº†ï¼Œå°±ä¼šè·³å‡ºå¾ªç¯</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">deadline</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">timeRemaining</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">works</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// è¿˜æœ‰ç©ºé—²æ—¶é—´ &amp;&amp; è¿˜æœ‰ä»»åŠ¡æ²¡æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å¦‚æœè¿˜æœ‰å‰©ä½™ä»»åŠ¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">works</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">åªå‰©ä¸‹</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">deadline</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">timeRemaining</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">msï¼Œä¸å¤Ÿäº†ï¼Œç­‰å¾…æµè§ˆå™¨ä¸‹æ¬¡ç©ºé—² çš„æ—¶å€™å†å¸®æˆ‘è°ƒç”¨</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          )</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">requestIdleCallback</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">workLoop</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">performUnitOfWork</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//å–å‡ºä»»åŠ¡æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¹¶ç§»é™¤ç¬¬ä¸€ä¸ªä»»åŠ¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">work</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">works</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shift</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">work</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><div class="language-lua line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">lua</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> æœ¬å¸§çš„å‰©ä½™æ—¶é—´æ˜¯ </span><span style="color:#F78C6C;">5.4</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬1ä¸ªä»»åŠ¡å¼€å§‹</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬1ä¸ªä»»åŠ¡ç»“æŸ</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> åªå‰©ä¸‹0msï¼Œä¸å¤Ÿäº†ï¼Œç­‰å¾…æµè§ˆå™¨ä¸‹æ¬¡ç©ºé—² çš„æ—¶å€™å†å¸®æˆ‘è°ƒç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> æœ¬å¸§çš„å‰©ä½™æ—¶é—´æ˜¯ </span><span style="color:#F78C6C;">3.3</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬2ä¸ªä»»åŠ¡å¼€å§‹</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬2ä¸ªä»»åŠ¡ç»“æŸ</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> åªå‰©ä¸‹0msï¼Œä¸å¤Ÿäº†ï¼Œç­‰å¾…æµè§ˆå™¨ä¸‹æ¬¡ç©ºé—² çš„æ—¶å€™å†å¸®æˆ‘è°ƒç”¨</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> æœ¬å¸§çš„å‰©ä½™æ—¶é—´æ˜¯ </span><span style="color:#F78C6C;">50</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬3ä¸ªä»»åŠ¡å¼€å§‹</span></span>
<span class="line"><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> ç¬¬3ä¸ªä»»åŠ¡ç»“æŸ</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="requestanimationframe" tabindex="-1">requestAnimationFrame <a class="header-anchor" href="#requestanimationframe" aria-label="Permalink to &quot;requestAnimationFrame&quot;">â€‹</a></h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/window/requestAnimationFrame" target="_blank" rel="noreferrer"><u>MDN requestAnimationFrame API ğŸš€</u></a></p><p><code>requestAnimationFrame</code> æ˜¯ HTML5 æä¾›çš„ä¸€ç§ APIï¼Œç”¨äºåœ¨æµè§ˆå™¨çš„ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚å®ƒæ˜¯ç”¨äºä¼˜åŒ–åŠ¨ç”»æ•ˆæœçš„å·¥å…·ï¼Œèƒ½å¤Ÿå¸®åŠ©ä½ å®ç°æ›´åŠ æµç•…ã€é«˜æ•ˆçš„åŠ¨ç”»ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„ <code>setTimeout</code> æˆ– <code>setInterval</code> æ¥æ§åˆ¶åŠ¨ç”»å¸§çš„æ›´æ–°ï¼Œ<code>requestAnimationFrame</code> æ›´åŠ ç²¾ç¡®ï¼Œå› ä¸ºå®ƒå¯ä»¥æ ¹æ®æµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡æ¥è°ƒæ•´åŠ¨ç”»çš„èŠ‚å¥ï¼Œä»è€Œé¿å…æ‰å¸§æˆ–è€…å¡é¡¿ã€‚</p><blockquote><p>ä¸¾ä¸ªä¾‹å­ ğŸŒ°</p></blockquote><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> start</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">step</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">timestamp</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">start</span><span style="color:#F07178;">) </span><span style="color:#BABED8;">start</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">timestamp</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è®°å½•èµ·å§‹æ—¶é—´</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">timestamp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">start</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// è®¡ç®—å·²ç»è¿‡å»çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">element</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">document</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getElementById</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">box</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ§åˆ¶ box çš„æ°´å¹³ç§»åŠ¨ï¼Œéšç€æ—¶é—´å‰è¿›</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">element</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">style</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">transform</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">translateX(</span><span style="color:#89DDFF;">\${</span><span style="color:#BABED8;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">min</span><span style="color:#BABED8;">(progress </span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">px)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å¦‚æœåŠ¨ç”»æœªå®Œæˆï¼Œç»§ç»­è°ƒç”¨ requestAnimationFrame</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">progress</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">requestAnimationFrame</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">step</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¯åŠ¨åŠ¨ç”»</span></span>
<span class="line"><span style="color:#82AAFF;">requestAnimationFrame</span><span style="color:#BABED8;">(step)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><strong><code>timestamp</code></strong>ï¼š<code>requestAnimationFrame</code> çš„å›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•° <code>timestamp</code>ï¼Œè¿™ä¸ªå‚æ•°æ˜¯æµè§ˆå™¨ä¼ é€’çš„å½“å‰å›è°ƒå‡½æ•°æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚å®ƒè¡¨ç¤ºè‡ªé¡µé¢åŠ è½½å®Œæˆä»¥æ¥çš„æ¯«ç§’æ•°ï¼Œå¯ä»¥ç”¨æ¥è®¡ç®—åŠ¨ç”»è¿›è¡Œçš„æ—¶é—´ã€‚</li></ul><h3 id="å¦‚ä½•å–æ¶ˆ-requestanimationframe" tabindex="-1">å¦‚ä½•å–æ¶ˆ <code>requestAnimationFrame</code> <a class="header-anchor" href="#å¦‚ä½•å–æ¶ˆ-requestanimationframe" aria-label="Permalink to &quot;å¦‚ä½•å–æ¶ˆ \`requestAnimationFrame\`&quot;">â€‹</a></h3><p>ä½ å¯ä»¥ä½¿ç”¨ <code>cancelAnimationFrame</code> æ¥åœæ­¢åŠ¨ç”»çš„æ‰§è¡Œï¼š</p><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> animationId </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">requestAnimationFrame</span><span style="color:#BABED8;">(step)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">stopAnimation</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">cancelAnimationFrame</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">animationId</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// åœæ­¢åŠ¨ç”»</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="ä¸»è¦ç‰¹ç‚¹" tabindex="-1">ä¸»è¦ç‰¹ç‚¹ <a class="header-anchor" href="#ä¸»è¦ç‰¹ç‚¹" aria-label="Permalink to &quot;ä¸»è¦ç‰¹ç‚¹&quot;">â€‹</a></h3><ul><li><p><strong>èŠ‚èƒ½é«˜æ•ˆ</strong>ï¼š <code>requestAnimationFrame</code> æ˜¯ç”±æµè§ˆå™¨æ¥å†³å®šå›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼Œé€šå¸¸ä¸æ˜¾ç¤ºå™¨çš„åˆ·æ–°é¢‘ç‡ç›¸åŒ¹é…ï¼ˆä¾‹å¦‚æ¯ç§’ 60 å¸§ï¼Œ60Hz æ˜¾ç¤ºå™¨ï¼‰ã€‚è¿™é¿å…äº†ä¸å¿…è¦çš„é‡ç»˜ï¼Œé™ä½äº† CPU å’Œ GPU çš„å¼€é”€ã€‚</p></li><li><p><strong>é¿å…å¤šä½™çš„é‡ç»˜</strong>ï¼š å¦‚æœé¡µé¢å½“å‰å¤„äºåå°æ ‡ç­¾é¡µæˆ–æœªæ˜¾ç¤ºçŠ¶æ€ï¼Œ<code>requestAnimationFrame</code> ä¼šæš‚åœå›è°ƒï¼Œä»è€ŒèŠ‚çœç³»ç»Ÿèµ„æºã€‚è€Œ <code>setTimeout</code> æˆ– <code>setInterval</code> åˆ™ä¼šç»§ç»­æ‰§è¡ŒåŠ¨ç”»ï¼Œå³ä½¿ç”¨æˆ·çœ‹ä¸åˆ°å˜åŒ–ã€‚</p></li><li><p><strong>å¸§åŒæ­¥</strong>ï¼š<code>requestAnimationFrame</code> å…è®¸åŠ¨ç”»ä¸æµè§ˆå™¨çš„åˆ·æ–°é¢‘ç‡ä¿æŒåŒæ­¥ï¼Œä»è€Œä½¿åŠ¨ç”»æ›´åŠ å¹³æ»‘ã€‚</p></li></ul><h3 id="requestanimationframe-vs-settimeout-setinterval" tabindex="-1"><code>requestAnimationFrame</code> vs <code>setTimeout</code>/<code>setInterval</code> <a class="header-anchor" href="#requestanimationframe-vs-settimeout-setinterval" aria-label="Permalink to &quot;\`requestAnimationFrame\` vs \`setTimeout\`/\`setInterval\`&quot;">â€‹</a></h3><ul><li><p><strong>ç²¾åº¦</strong>ï¼š<code>requestAnimationFrame</code> èƒ½å¤Ÿæ ¹æ®æµè§ˆå™¨çš„åˆ·æ–°ç‡ç²¾ç¡®åŒæ­¥åŠ¨ç”»å¸§ï¼Œè€Œ <code>setTimeout</code>/<code>setInterval</code> ä¾èµ–äº <code>JavaScript</code> å¼•æ“çš„å®šæ—¶æœºåˆ¶ï¼Œå¯èƒ½ä¼šä¸å¤Ÿç²¾ç¡®ã€‚</p></li><li><p><strong>èŠ‚èƒ½</strong>ï¼šå½“é¡µé¢ä¸åœ¨å‰å°æ˜¾ç¤ºæ—¶ï¼Œ<code>requestAnimationFrame</code> ä¼šè‡ªåŠ¨æš‚åœæ‰§è¡Œï¼Œä»è€ŒèŠ‚çœ <code>CPU</code> èµ„æºï¼›è€Œ <code>setTimeout</code> å’Œ <code>setInterval</code> ä»ç„¶ä¼šç»§ç»­è¿è¡Œã€‚</p></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š<code>requestAnimationFrame</code> å†…ç½®æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼Œä¸æµè§ˆå™¨çš„æ¸²æŸ“å‘¨æœŸç´§å¯†ç»“åˆï¼Œé¿å…äº†ä¸å¿…è¦çš„æ¸²æŸ“å’Œè®¡ç®—ï¼Œä»è€Œæé«˜äº†æ€§èƒ½å’ŒåŠ¨ç”»æµç•…åº¦ã€‚</p></li></ul><h2 id="messagechannel" tabindex="-1"><code>MessageChannel</code> <a class="header-anchor" href="#messagechannel" aria-label="Permalink to &quot;\`MessageChannel\`&quot;">â€‹</a></h2><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MessageChannel" target="_blank" rel="noreferrer"><u>MDN MessageChannel API ğŸš€</u></a></p><p><code>MessageChannel</code> æ˜¯ <code>Web API</code> ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ç§åœ¨ä¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡ï¼ˆå¦‚ä¸åŒçš„ <code>window</code>ã€<code>iframe</code>ã€<code>worker</code> ç­‰ï¼‰ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„æ–¹å¼ã€‚å®ƒå…è®¸ä¸¤ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¹‹é—´å»ºç«‹ä¸€ä¸ªåŒå‘é€šä¿¡é€šé“ï¼Œä½¿ç”¨ <code>MessageChannel</code> çš„ä¸¤ä¸ª <code>MessagePort</code> å¯¹è±¡æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</p><h3 id="messagechannel-çš„æ„æˆ" tabindex="-1"><code>MessageChannel</code> çš„æ„æˆ <a class="header-anchor" href="#messagechannel-çš„æ„æˆ" aria-label="Permalink to &quot;\`MessageChannel\` çš„æ„æˆ&quot;">â€‹</a></h3><ul><li><p><strong><code>MessageChannel</code></strong>ï¼šè¿™æ˜¯ä¸»è¦çš„å¯¹è±¡ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é€šé“ã€‚</p></li><li><p><strong><code>MessagePort</code></strong>ï¼šå½“ä½ åˆ›å»ºä¸€ä¸ª <code>MessageChannel</code> å¯¹è±¡æ—¶ï¼Œå®ƒä¼šç”Ÿæˆä¸¤ä¸ª <code>MessagePort</code> å¯¹è±¡ã€‚ä¸¤ä¸ªç«¯å£å¯¹è±¡å¯ä»¥åˆ†åˆ«å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚å®ƒä»¬é€šè¿‡ <code>postMessage</code> æ–¹æ³•å‘é€æ¶ˆæ¯ï¼Œä½¿ç”¨ <code>onmessage</code> äº‹ä»¶å¤„ç†ç¨‹åºæ¥æ”¶æ¶ˆæ¯ã€‚</p></li><li><p><strong><code>postMessage</code></strong>ï¼šä½¿ç”¨ <code>postMessage</code> æ–¹æ³•å‘é€æ¶ˆæ¯åˆ°å¦ä¸€ç«¯çš„ <code>MessagePort</code>ã€‚</p></li><li><p><strong><code>onmessage</code></strong>ï¼šç”¨äºæ¥æ”¶æ¶ˆæ¯çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚</p></li></ul><blockquote><p>ä¸¾ä¸ªä¾‹å­ ğŸŒ°</p></blockquote><div class="language-javascript line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åˆ›å»ºä¸€ä¸ªæ–°çš„ MessageChannel å®ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> channel </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">MessageChannel</span><span style="color:#BABED8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è·å–ä¸¤ä¸ª MessagePort</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> port1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">port1</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> port2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> channel</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">port2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç›‘å¬ port1 çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#BABED8;">port1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onmessage</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Message received at port1:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ç›‘å¬ port2 çš„æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#BABED8;">port2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onmessage</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Message received at port2:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ postMessage å‘é€æ¶ˆæ¯</span></span>
<span class="line"><span style="color:#BABED8;">port1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">postMessage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello from port1!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">port2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">postMessage</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hello from port2!</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>è¾“å‡º</p></blockquote><div class="language-sh line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Message</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">received</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">at</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">port1:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Hello</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">from</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">port2!</span></span>
<span class="line"><span style="color:#FFCB6B;">Message</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">received</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">at</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">port2:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Hello</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">from</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">port1!</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="ä¸»è¦ç‰¹ç‚¹-1" tabindex="-1">ä¸»è¦ç‰¹ç‚¹ <a class="header-anchor" href="#ä¸»è¦ç‰¹ç‚¹-1" aria-label="Permalink to &quot;ä¸»è¦ç‰¹ç‚¹&quot;">â€‹</a></h3><ul><li><strong>åŒå‘é€šä¿¡</strong>ï¼šæ¯ä¸ª <code>MessagePort</code> å¯ä»¥åŒæ—¶å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚</li><li><strong>è·¨ä¸Šä¸‹æ–‡</strong>ï¼šå¯ä»¥åœ¨ä¸åŒçš„æµè§ˆå™¨ä¸Šä¸‹æ–‡ä¹‹é—´ï¼ˆå¦‚ <code>window</code>ã€<code>iframe</code>ã€<code>web worker</code>ï¼‰è¿›è¡Œé€šä¿¡ã€‚</li><li><strong>æ— å‰¯ä½œç”¨çš„é€šä¿¡</strong>ï¼šä¸ <code>DOM</code> æ²¡æœ‰ç›´æ¥çš„å…³ç³»ï¼Œæ¶ˆæ¯ä¼ é€’æœºåˆ¶æ˜¯ç‹¬ç«‹çš„ï¼Œé¿å…äº†æ€§èƒ½å¼€é”€ã€‚</li></ul><h3 id="messagechannel-å’Œ-postmessage-çš„åŒºåˆ«" tabindex="-1"><code>MessageChannel</code> å’Œ <code>postMessage</code> çš„åŒºåˆ« <a class="header-anchor" href="#messagechannel-å’Œ-postmessage-çš„åŒºåˆ«" aria-label="Permalink to &quot;\`MessageChannel\` å’Œ \`postMessage\` çš„åŒºåˆ«&quot;">â€‹</a></h3><ul><li><code>postMessage</code> æ˜¯å…¨å±€çš„è·¨ä¸Šä¸‹æ–‡é€šä¿¡æ–¹å¼ï¼Œå…è®¸é¡µé¢ä¸åŒæºæˆ–è·¨åŸŸçš„ <code>iframe</code> ä»¥åŠåŒåŸŸçš„ worker ä¹‹é—´é€šä¿¡ã€‚</li><li><code>MessageChannel</code> æä¾›çš„æ˜¯ç‹¬ç«‹çš„ã€åŸºäº <code>MessagePort</code> çš„åŒå‘é€šä¿¡é€šé“ï¼Œå¯ä»¥é€šè¿‡ä¼ é€’ <code>MessagePort</code> å¯¹è±¡ï¼Œåœ¨å¤šä¸ªä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚</li></ul><h2 id="localstorage" tabindex="-1"><code>LocalStorage</code> <a class="header-anchor" href="#localstorage" aria-label="Permalink to &quot;\`LocalStorage\`&quot;">â€‹</a></h2><p>ç”Ÿå‘½å‘¨æœŸï¼šé™¤éè¢«æ‰‹åŠ¨æ¸…é™¤ï¼Œå¦åˆ™å°†ä¼šæ°¸ä¹…ä¿å­˜</p><p>å¤§å°ï¼šå¯ä»¥ä¿å­˜<code>5MB</code>çš„ä¿¡æ¯</p><div class="tip custom-block"><p class="custom-block-title">æ³¨æ„</p><ul><li><p><code>localStorage</code> å†™å…¥çš„æ—¶å€™ï¼Œå¦‚æœè¶…å‡ºå®¹é‡ä¼šæŠ¥é”™ï¼Œä½†ä¹‹å‰ä¿å­˜çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚</p></li><li><p><code>localStorage</code> å­˜å‚¨å®¹é‡å¿«è¦æ»¡çš„æ—¶å€™ï¼Œ<code>getItem</code> æ–¹æ³•æ€§èƒ½ä¼šæ€¥å‰§ä¸‹é™ã€‚</p></li></ul></div><div class="tip custom-block"><p class="custom-block-title">ä¸ºä»€ä¹ˆåŒåŸŸä¸‹å¤šçª—å£é—´<code>localStorage</code>èƒ½å…±äº«</p><ul><li>åŒæºç­–ç•¥</li></ul><p>ç”±äºåŒæºç­–ç•¥ï¼Œæ¥è‡ªåŒä¸€ä¸ªæºçš„å¤šä¸ªçª—å£æˆ–æ ‡ç­¾é¡µå¯ä»¥è®¿é—®åŒä¸€ä»½ <code>localStorage</code> æ•°æ®</p><ul><li>æŒä¹…æ€§å­˜å‚¨</li></ul><p><code>localStorage</code> æ•°æ®æ˜¯æŒä¹…çš„ï¼Œæ„å‘³ç€å®ƒä¸ä¼šåœ¨æµè§ˆå™¨å…³é—­æ—¶è¢«æ¸…é™¤ã€‚ç›¸åŒæºçš„å¤šä¸ªçª—å£æˆ–æ ‡ç­¾é¡µåœ¨è®¿é—® <code>localStorage</code> æ—¶ï¼Œå®ƒä»¬å®é™…ä¸Šéƒ½åœ¨è®¿é—®åŒä¸€ä»½å­˜å‚¨æ•°æ®ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªçª—å£æˆ–æ ‡ç­¾é¡µå¯¹ <code>localStorage</code> è¿›è¡Œäº†å†™å…¥ï¼Œå…¶ä»–çª—å£æˆ–æ ‡ç­¾é¡µå¯ä»¥ç«‹å³è¯»å–åˆ°è¿™äº›æ•°æ®ã€‚</p><ul><li>äº‹ä»¶é€šçŸ¥</li></ul><p>å½“æŸä¸ªçª—å£æˆ–æ ‡ç­¾é¡µå¯¹ <code>localStorage</code> è¿›è¡Œäº†æ›´æ”¹ï¼Œå…¶ä»–åŒæºçš„çª—å£æˆ–æ ‡ç­¾é¡µä¼šæ”¶åˆ° <code>storage</code> äº‹ä»¶é€šçŸ¥ã€‚è¿™ä½¿å¾—å®ƒä»¬èƒ½å¤ŸåŠæ—¶æ›´æ–°è‡ªå·±å¯¹ <code>localStorage</code> çš„è¯»å–ï¼Œä¿æŒæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨ä¸€ä¸ªçª—å£ä¸­å¯¹ localStorage è¿›è¡Œæ›´æ”¹</span></span>
<span class="line"><span style="color:#BABED8;">localStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">value</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// åœ¨å…¶ä»–çª—å£ä¸­ç›‘å¬ storage äº‹ä»¶</span></span>
<span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addEventListener</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">storage</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">key</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">New value: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">newValue</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/localStorage" target="_blank" rel="noreferrer"><u><code>LocalStorage | MDN</code></u></a></li></ul></div><h2 id="sessionstorage" tabindex="-1"><code>SessionStorage</code> <a class="header-anchor" href="#sessionstorage" aria-label="Permalink to &quot;\`SessionStorage\`&quot;">â€‹</a></h2><p>ç”Ÿå‘½å‘¨æœŸï¼šä»…åœ¨å½“å‰ç½‘é¡µä¼šè¯ä¸‹æœ‰æ•ˆï¼Œå…³é—­é¡µé¢æˆ–æµè§ˆå™¨åå°±ä¼šè¢«æ¸…é™¤</p><p>å¤§å°ï¼šå¯ä»¥ä¿å­˜<code>5MB</code>çš„ä¿¡æ¯</p><div class="tip custom-block"><p class="custom-block-title">å¤šçª—å£ä¹‹é—´<code>sessionStorage</code>ä¸èƒ½å…±äº«çŠ¶æ€å—ï¼Ÿ</p><p>ç­”æ¡ˆï¼š<strong>å¤šçª—å£ä¹‹é—´<code>sessionStorage</code>ä¸å¯ä»¥å…±äº«çŠ¶æ€ï¼ï¼ï¼ä½†æ˜¯åœ¨ç‰¹å®šåœºæ™¯ä¸‹æ–°å¼€çš„é¡µé¢ä¼šå¤åˆ¶ä¹‹å‰é¡µé¢çš„<code>sessionStorage</code>ï¼ï¼</strong></p></div><blockquote><p>ä¸¾ä¸ª ğŸŒ°</p></blockquote><ul><li>ç°æœ‰é¡µé¢<code>A</code>ï¼Œåœ¨é¡µé¢<code>A</code>ä¸­æ‰§è¡Œ</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pageA_1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>åœ¨é¡µé¢ä¸­æœ‰ä¸ª<code>button</code>æŒ‰é’®ï¼Œç‚¹å‡»æŒ‰é’®è§¦å‘ <code>window.open(&quot;åŒæºé¡µé¢&quot;)</code>ï¼Œç°å¾—åˆ°æ–°å¼€çš„é¡µé¢<code>B</code>ï¼Œåœ¨<code>B</code>ä¸­æ‰§è¡Œ</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pageA_1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">//æ‹¿åˆ°çš„ç»“æœæ˜¯ &quot;123&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>åœ¨é¡µé¢<code>A</code>ä¸­ç»§ç»­æ‰§è¡Œ</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pageA_1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">456</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">) (ä¹‹å‰çš„pageA_1è®¾ç½®çš„å€¼æ˜¯ â€˜</span><span style="color:#F78C6C;">123</span><span style="color:#BABED8;">â€™ )</span></span>
<span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pageA_2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">789</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>åœ¨é¡µé¢<code>B</code>ä¸­å†æ¬¡å°è¯•è·å–</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pageA_1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">//æ‹¿åˆ°çš„ç»“æœè¿˜æ˜¯ &quot;123&quot;</span></span>
<span class="line"><span style="color:#BABED8;">window</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">sessionStorage</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getItem</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pageA_2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">//æ‹¿åˆ°çš„ç»“æœæ˜¯ null</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>åœ¨è¯¥æ ‡ç­¾æˆ–çª—å£æ‰“å¼€ä¸€ä¸ªæ–°é¡µé¢æ—¶ä¼šå¤åˆ¶é¡¶çº§æµè§ˆä¼šè¯çš„ä¸Šä¸‹æ–‡ä½œä¸ºæ–°ä¼šè¯çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ï¼Œåœ¨æ‰“å¼€æ–°çš„åŒæºé¡µé¢æ—¶ï¼Œä¼šå¤åˆ¶ä¹‹å‰é¡µé¢çš„<code>sessionStorage</code></strong></p><div class="tip custom-block"><p class="custom-block-title">å¯¹äº<code>a</code>æ ‡ç­¾ï¼Œæ–°æ‰“å¼€çš„é¡µé¢</p><p>åœ¨<code>Chrome 89</code>çš„ç‰ˆæœ¬ï¼Œ<code>Stop cloning sessionStorage for windows opened with noopener</code>ï¼Œè€Œ<code>a</code>æ ‡ç­¾<code>_blank</code>é»˜è®¤ <code>rel=&quot;noopener&quot;</code> ã€‚</p><p>æ‰€ä»¥<code>a</code>æ ‡ç­¾éœ€è¦åŠ å…¥<code>rel=&quot;opener&quot;</code> è€Œæ‰èƒ½åƒ<code>window.open(&quot;åŒæºé¡µé¢&quot;)\`\`è¿™ç§æ–¹å¼æ–°å¼€çš„é¡µé¢ä¼šå¤åˆ¶ä¹‹å‰çš„sessionStorage</code></p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">href</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://...</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">target</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_blank</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">rel</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">opener</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">Link</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">a</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li><a href="https://stackoverflow.com/questions/57330335/why-is-sessionstorage-preserved-across-multiple-tabs" target="_blank" rel="noreferrer"><u>Why is sessionStorage preserved across multiple tabs | stackoverflow</u></a></li></ul></div><div class="tip custom-block"><p class="custom-block-title">æ€»ç»“</p><ul><li><p>é¡µé¢ä¼šè¯åœ¨æµè§ˆå™¨æ‰“å¼€æœŸé—´ä¸€ç›´ä¿æŒï¼Œå¹¶ä¸”é‡æ–°åŠ è½½æˆ–æ¢å¤é¡µé¢ä»ä¼šä¿æŒåŸæ¥çš„é¡µé¢ä¼šè¯ã€‚</p></li><li><p>åœ¨æ–°æ ‡ç­¾æˆ–çª—å£æ‰“å¼€ä¸€ä¸ªé¡µé¢æ—¶ä¼šå¤åˆ¶é¡¶çº§æµè§ˆä¼šè¯çš„ä¸Šä¸‹æ–‡ä½œä¸ºæ–°ä¼šè¯çš„ä¸Šä¸‹æ–‡ã€‚</p></li><li><p>æ‰“å¼€å¤šä¸ªç›¸åŒçš„ <code>URL</code> çš„ <code>Tabs</code> é¡µé¢ï¼Œä¼šåˆ›å»ºå„è‡ªçš„ Â <code>sessionStorage</code>ã€‚</p></li><li><p>å…³é—­å¯¹åº”æµè§ˆå™¨æ ‡ç­¾æˆ–çª—å£ï¼Œä¼šæ¸…é™¤å¯¹åº”çš„ Â <code>sessionStorage</code>ã€‚</p></li></ul></div><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/sessionStorage" target="_blank" rel="noreferrer"><u><code>SessionStorage | MDN</code></u></a></li></ul></div><h2 id="web-storage" tabindex="-1"><code>Web Storage</code> <a class="header-anchor" href="#web-storage" aria-label="Permalink to &quot;\`Web Storage\`&quot;">â€‹</a></h2><p><code>localStorage</code> ä¸ <code>sessionStorage</code>ä¸¤è€…å…¶å®éƒ½æ‹¥æœ‰ä¸€ä¸ªç›¸åŒçš„åŸå‹å¯¹è±¡ <code>Storage</code>ã€‚</p><p><code>Web Storage</code> åŒ…å«å¦‚ä¸‹ä¸¤ç§æœºåˆ¶ï¼š</p><ul><li><code>sessionStorage</code>Â  ä¸ºæ¯ä¸€ä¸ªç»™å®šçš„æºç»´æŒä¸€ä¸ªç‹¬ç«‹çš„å­˜å‚¨åŒºåŸŸï¼Œè¯¥å­˜å‚¨åŒºåŸŸåœ¨é¡µé¢ä¼šè¯æœŸé—´å¯ç”¨ï¼ˆå³åªè¦æµè§ˆå™¨å¤„äºæ‰“å¼€çŠ¶æ€ï¼ŒåŒ…æ‹¬é¡µé¢é‡æ–°åŠ è½½å’Œæ¢å¤ï¼‰ã€‚</li><li><code>localStorage</code>Â  åŒæ ·çš„åŠŸèƒ½ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨å…³é—­ï¼Œç„¶åé‡æ–°æ‰“å¼€åæ•°æ®ä»ç„¶å­˜åœ¨ã€‚</li></ul><p>ä½œä¸º <code>Web Storage API</code> çš„æ¥å£ï¼Œ<code>Storage</code> æä¾›äº†è®¿é—®ç‰¹å®šåŸŸåä¸‹çš„ä¼šè¯å­˜å‚¨æˆ–æœ¬åœ°å­˜å‚¨çš„åŠŸèƒ½ã€‚</p><p>ä¾‹å¦‚ï¼Œå¯ä»¥æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤å­˜å‚¨çš„æ•°æ®é¡¹ã€‚</p><h3 id="å±æ€§-æ–¹æ³•" tabindex="-1">å±æ€§ &amp; æ–¹æ³• <a class="header-anchor" href="#å±æ€§-æ–¹æ³•" aria-label="Permalink to &quot;å±æ€§ &amp; æ–¹æ³•&quot;">â€‹</a></h3><ul><li><code>Storage.length</code>Â  åªè¯»</li></ul><p>è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå­˜å‚¨åœ¨ Â <code>Storage</code>Â  å¯¹è±¡ä¸­çš„æ•°æ®é¡¹æ•°é‡ã€‚</p><ul><li><code>Storage.key()</code></li></ul><p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°å€¼ <code>n</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›å­˜å‚¨ä¸­çš„ç¬¬ <code>n</code> ä¸ªé”®åã€‚</p><ul><li><code>Storage.getItem()</code></li></ul><p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®åä½œä¸ºå‚æ•°ï¼Œè¿”å›é”®åå¯¹åº”çš„å€¼ã€‚</p><ul><li><code>Storage.setItem()</code></li></ul><p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®åå’Œå€¼ä½œä¸ºå‚æ•°ï¼Œå°†ä¼šæŠŠé”®å€¼å¯¹æ·»åŠ åˆ°å­˜å‚¨ä¸­ï¼Œå¦‚æœé”®åå­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å¯¹åº”çš„å€¼ã€‚</p><ul><li><code>Storage.removeItem()</code></li></ul><p>è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªé”®åä½œä¸ºå‚æ•°ï¼Œå¹¶æŠŠè¯¥é”®åä»å­˜å‚¨ä¸­åˆ é™¤ã€‚</p><ul><li><code>Storage.clear()</code></li></ul><p>è°ƒç”¨è¯¥æ–¹æ³•ä¼šæ¸…ç©ºå­˜å‚¨ä¸­çš„æ‰€æœ‰é”®åã€‚</p><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Storage_API" target="_blank" rel="noreferrer"><u>Web Storage API | MDN</u></a></li></ul></div><h2 id="indexeddb" tabindex="-1"><code>indexedDB</code> <a class="header-anchor" href="#indexeddb" aria-label="Permalink to &quot;\`indexedDB\`&quot;">â€‹</a></h2><p><code>IndexedDB</code> æ˜¯ä¸€ç§åº•å±‚ <code>API</code>ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å­˜å‚¨å¤§é‡çš„ç»“æ„åŒ–æ•°æ®ï¼ˆä¹ŸåŒ…æ‹¬æ–‡ä»¶/äºŒè¿›åˆ¶å¤§å‹å¯¹è±¡ï¼ˆ<code>blobs</code>ï¼‰ï¼‰ã€‚è¯¥ <code>API</code> ä½¿ç”¨ç´¢å¼•å®ç°å¯¹æ•°æ®çš„é«˜æ€§èƒ½æœç´¢ã€‚</p><p>ä½¿ç”¨ <code>IndexedDB</code> æ‰§è¡Œçš„æ“ä½œæ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œä»¥å…é˜»å¡åº”ç”¨ç¨‹åºã€‚</p><p>åº”ç”¨åœºæ™¯ï¼šé€‚åˆå­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®ï¼Œå¦‚ç¦»çº¿æ•°æ®ã€æ–‡ä»¶ç¼“å­˜ç­‰ã€‚</p><p>å­˜å‚¨å¤§å°ï¼šæµè§ˆå™¨ä¸åŒï¼Œä½†é€šå¸¸æ˜¯ <code>50MB</code> åˆ°<code>å‡ ç™¾ MB</code>ã€‚</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> request </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> indexedDB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">open</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">MyDatabase</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="info custom-block"><p class="custom-block-title">ç›¸å…³èµ„æ–™</p><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/IndexedDB_API" target="_blank" rel="noreferrer"><u>MDN indexDB API ğŸš€</u></a></li></ul></div>`,110)]))}const d=a(p,[["render",e]]);export{F as __pageData,d as default};
