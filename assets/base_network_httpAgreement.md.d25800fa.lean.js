import{_ as a,B as p,o as h,c as n,x as e,D as d,z as t,a as o,Q as l}from"./chunks/framework.a5035e6c.js";const i="/assets/http2.2a937e09.png",s="/assets/header_zip.07c96157.png",r="/assets/http2.51ea31f1.jpg",_="/assets/http2_construct.9a54b44a.png",u="/assets/http3.e34934ef.jpeg",xe=JSON.parse('{"title":"HTTP 协议","description":"","frontmatter":{},"headers":[],"relativePath":"base/network/httpAgreement.md","lastUpdated":1702973334000}'),T={name:"base/network/httpAgreement.md"},P=l("",9),C=e("p",null,[o("线头阻塞："),e("code",null,"TCP"),o(" 连接上只能发送一个请求，前面的请求未完成前，后续的请求都在排队等待。 针对队头阻塞,人们尝试过以下办法来解决：")],-1),m=e("code",null,"Chrome",-1),b=e("code",null,"TCP",-1),S=e("code",null,"TCP",-1),f=e("code",null,"chrome",-1),q=e("p",null,[o("精灵图，"),e("code",null,"Spriting"),o(" 合并多张小图为一张大图,再用 "),e("code",null,"JavaScript"),o(" 或者 "),e("code",null,"CSS"),o(" 将小图重新“切割”出来的技术。")],-1),k=e("code",null,"(Inlining)",-1),I=e("code",null,"CSS",-1),x=e("code",null,"URL",-1),D=e("p",null,[o("拼接"),e("code",null,"(Concatenation)"),o("将多个体积较小的 "),e("code",null,"JavaScript"),o(" 使用"),e("code",null,"webpack"),o("等工具打包成 1 个体积更大的"),e("code",null,"JavaScript"),o("文件,但如果其中 1 个文件的改动就会导致大量数据被重新下载多个文件。")],-1),g=e("li",null,[e("p",null,[o("多个 "),e("code",null,"TCP"),o(" 连接")])],-1),F=e("p",null,[o("虽然 "),e("code",null,"http/1.1"),o(" 管线化可以支持请求并发，所以 1.1 版本请求并发依赖于多个 "),e("code",null,"TCP"),o(" 连接，建立 "),e("code",null,"TCP"),o(" 连接成本很高，还会存在慢启动的问题。")],-1),U=e("ol",{start:"3"},[e("li",null,"头部冗余，采用文本格式")],-1),A=e("code",null,"http/1.x",-1),R=e("code",null,"cookie",-1),Q=e("code",null,"user-agent",-1),L=e("code",null,"http",-1),E=e("code",null,"cookie",-1),H=e("code",null,"Header",-1),V=e("code",null,'"User Agent"',-1),v=e("code",null,'"Cookie"',-1),N=e("code",null,'"Accept"',-1),w=e("code",null,'"Server"',-1),y=e("code",null,"Body",-1),B=e("code",null,"GET",-1),G=e("code",null,"Header",-1),W={start:"4"},j=e("li",null,"客户端需要主动请求",-1),J=e("code",null,"http/1.1",-1),K=e("h2",{id:"http-2",tabindex:"-1"},[e("code",null,"http/2"),o(),e("a",{class:"header-anchor",href:"#http-2","aria-label":'Permalink to "`http/2`"'},"​")],-1),$=e("code",null,"http/2",-1),z=e("code",null,"http/2",-1),M=e("code",null,"http",-1),O=e("code",null,"（http/1.x）",-1),Y=e("code",null,"http",-1),X=e("code",null,"http/1.x ",-1),Z=e("code",null,"http/2",-1),ee=e("code",null,"SPDY",-1),oe=e("code",null,"（connection）",-1),ce=e("code",null,"http/2",-1),de=e("code",null,"http/2",-1),te=e("p",null,[e("code",null,"http/2"),o(" 由两个规范"),e("code",null,"（Specification）"),o("组成：")],-1),le=e("ul",null,[e("li",null,[e("code",null,"Hypertext Transfer Protocol version 2 - RFC7540")]),e("li",null,[e("code",null,"HPACK - Header Compression for http/2 - RFC7541")])],-1),ae=e("code",null,"http/2",-1),pe=e("code",null,"Header",-1),he=l("",9),ne=e("code",null,"http/2",-1),ie=e("code",null,"HPACK",-1),se=l("",8),re=l("",40),_e=e("code",null,"0RTT",-1),ue=e("code",null,"QUIC",-1),Te=e("code",null,"http2",-1),Pe=l("",20);function Ce(me,be,Se,fe,qe,ke){const c=p("font");return h(),n("div",null,[P,e("ol",null,[e("li",null,[C,e("ul",null,[e("li",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("同一页面的资源分散到不同域名下，提升连接上限。")]),_:1}),e("p",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[m,o(" 有个机制，对于同一个域名，默认允许同时建立 6 个 "),b,o(" 持久连接")]),_:1})]),o("，使用持久连接时，虽然能公用一个 "),S,o(" 管道，但是在一个管道中同一时刻只能处理一个请求，在当前的请求没有结束之前，其他的请求只能处于阻塞状态。另外如果在同一个域名下同时有 10 个请求发生，那么其中 4 个请求会进入排队等待状态，直至进行中的请求完成（"),f,o(" 放弃了）")])]),e("li",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("合并小文件减少资源数。")]),_:1}),q]),e("li",null,[e("p",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("内联"),k,o("资源是另外一种防止发送很多小图请求的技巧")]),_:1})]),o("，将图片的原始数据嵌入在 "),I,o("文件里面的"),x,o("里，减少网络请求次数。")])]),e("li",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("减少请求数量。")]),_:1}),D])])]),g]),F,U,e("ul",null,[e("li",null,[o("**"),d(c,{color:"FF9D00"},{default:t(()=>[A,o(" 版本是采用文本格式，首部未压缩，")]),_:1}),o("**而且每一个请求都会带上 "),R,o("、"),Q,o(" 等完全相同的首部。")]),e("li",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("无状态是指协议对于连接状态没有记忆能力。")]),_:1}),o("纯净的 "),L,o(" 是没有 "),E,o(" 等机制的，每一个连接都是一个新的连接。")]),e("li",null,[o("由于报文 "),H,o(" 一般会携带"),V,o("、"),v,o("、"),N,o("、"),w,o("等许多固定的头字段，多达几百字节甚至上千字节，但 "),y,o(" 却经常只有几十字节（比如 "),B,o(" 请求、204/301/304 响应），成了不折不扣的“大头儿子”。"),e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[G,o(" 里携带的内容过大，在一定程度上增加了传输的成本。更要命的是，请求响应报文里有大量字段值都是重复的，非常浪费。")]),_:1})])])]),e("ol",W,[j,e("li",null,[J,o(" 在传输数据时，所有传输的"),d(c,{color:"FF9D00"},{default:t(()=>[o("内容都是明文")]),_:1}),o("内容都是明文，客户端和服务器端都无法验证对方的身份，这在一定程度上无法保证数据的安全性。")])]),K,e("p",null,[o("2015 年，"),$,o(" 发布。"),z,o(" 是现行 "),M,o(" 协议"),O,o("的替代，但它不是重写，"),Y,o(" 方法/状态码/语义都与 "),X,o("一样。 "),Z,o(" 基于 "),ee,o("，专注于性能，最大的一个目标是在用户和网站间只用一个连接"),oe,o("。从目前的情况来看，国内外一些排名靠前的站点基本都实现了 "),ce,o(" 的部署，"),e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("使用 "),de,o(" 能带来 20%~60%的效率提升。")]),_:1})])]),te,le,e("p",null,[e("strong",null,[d(c,{color:"FF4229"},{default:t(()=>[ae,o(" 传输数据量的大幅减少,主要有两个原因:以二进制方式传输和 "),pe,o(" 压缩。")]),_:1})])]),he,e("p",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[ne,o(" 为此采用 "),ie,o(" 压缩格式来压缩首部。头部压缩需要在浏览器和服务器端之间：")]),_:1})])]),se,e("ul",null,[e("li",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("同域名下所有通信都在单个连接上完成。")]),_:1})])]),e("li",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("单个连接可以承载任意数量的双向数据流。")]),_:1})])]),e("li",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[o("数据流以消息的形式发送，而消息又由一个或多个帧组成，多个帧之间可以乱序发送，因为根据帧首部的流标识可以重新组装。")]),_:1})])])]),re,e("p",null,[e("strong",null,[d(c,{color:"FF9D00"},{default:t(()=>[_e,o(" 建连可以说是 "),ue,o(" 相比 "),Te,o(" 最大的性能优势。")]),_:1})])]),Pe])}const De=a(T,[["render",Ce]]);export{xe as __pageData,De as default};
